<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>分布式TensorFlow搭建和使用 - LiYu's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Economics"/>
    <meta name="description" content="A wiki website of sthsf when I learned new knowledgy and technics."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Algorithm">Algorithm</a>&nbsp;»&nbsp;<a href="/wiki/#Algorithm-DeepLearning">DeepLearning</a>&nbsp;»&nbsp;<a href="/wiki/#Algorithm-DeepLearning-Tensorflow学习笔记">Tensorflow学习笔记</a>&nbsp;»&nbsp;分布式TensorFlow搭建和使用</div>
</div>
<div class="clearfix"></div>
<div id="title">分布式TensorFlow搭建和使用</div>
<div id="content">
  <h1 id="_1">写在前面</h1>
<p>使用tensorflow接近一年时间，然而一直使用的是cpu版本的，而且还是在笔记本上跑程序的，所以当训练模型时，你懂的，我都心疼我的笔记本，最近公司刚刚给配了台带了块GTX 1080的台式机。嗯，终于算入门了，台式机的配置如下：</p>
<div class="hlcode"><pre><span class="n">System</span><span class="err">：</span><span class="n">Ubuntu</span> <span class="mf">16.04</span> <span class="n">LTS</span>
<span class="nl">CPU:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i7</span><span class="o">-</span><span class="mi">7700</span> <span class="n">CPU</span> <span class="err">@</span> <span class="mf">3.60</span><span class="n">GHz</span>
<span class="nl">MemTotal:</span> <span class="mi">16295024</span> <span class="n">kB</span>
<span class="nl">GPU:</span> <span class="n">GeForce</span> <span class="n">GTX</span> <span class="mi">1080</span>
</pre></div>


<p>目前来说够用了。大佬就可以忽略这段的。下面说说我在安装配置tensorflow-gpu的时候遇到的问题</p>
<h1 id="n">一、N卡驱动安装</h1>
<h4 id="1ubuntu">1、ubuntu自带</h4>
<p>安装之前使用<code>sudo apt-get install upgrade</code>将系统的软件进行升级。<br />
然后在System Settings -&gt; Software&amp;Update -&gt; Additional Drivers 下，等待刷新完毕后，会出现 NVIDIA Corporation：Unknown，如下图所示。然后勾选第一个选项，然后点击更新。更新完成后重启电脑。<br />
<center><img src="/wiki/static/images/tensorgpu/settings.png" alt="settings"/></center></p>
<p>重新打开终端，输入nvidia-smi，就会出现显卡的相关信息, 如下图所示。</p>
<p><center><img src="/wiki/static/images/tensorgpu/nvidia-driver.png" alt="nvidia-driver"/></center><br />
 #### 主意；用这种方法在安装cuda9.1的时候会出现状况。在运行测试用例的时候，系统会提示cuda驱动版本不一致，我查看了下官方此时已经更新到390.48了。</p>
<h4 id="2nvidia">2、Nvidia官网下载对应显卡驱动安装</h4>
<p>1、去<a href="http://www.nvidia.cn/Download/index.aspx?lang=cn">nvidia官网</a>下载对应的驱动，根据自己的显卡型号和操作系统手动查找对应的驱动文件，我的显卡是GTX1080，所以下载的驱动文件名为<strong>NVIDIA-Linux-x86_64-390.48.run</strong>。如下图所示。<br />
<center><img src="/wiki/static/images/tensorgpu/nvidia_driver.jpg" alt="nvidia-driver"/></center></p>
<p>2、先卸载原有N卡驱动</p>
<div class="hlcode"><pre><span class="cp">#for case1: original driver installed by apt-get:</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">remove</span> <span class="o">--</span><span class="n">purge</span> <span class="n">nvidia</span><span class="o">*</span>

<span class="cp">#for case2: original driver installed by runfile:</span>
<span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">*</span><span class="p">.</span><span class="n">run</span>
<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">NVIDIA</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">384.59</span><span class="p">.</span><span class="n">run</span> <span class="o">--</span><span class="n">uninstall</span>
</pre></div>


<p>如果原驱动是用apt-get安装的，就用第1种方法卸载。 <br />
如果原驱动是用runfile安装的，就用–uninstall命令卸载。其实，用runfile安装的时候也会卸载掉之前的驱动，所以不手动卸载亦可。</p>
<p>3、禁用nouveau驱动</p>
<p>创建或更新blacklist-nouveau.conf，有的教程中会更新blacklist.conf</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">modprobe</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">blacklist</span><span class="o">-</span><span class="n">nouveau</span><span class="p">.</span><span class="n">conf</span>
<span class="n">or</span>
<span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">modprobe</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">blacklist</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<p>在文本最后添加：（禁用nouveau第三方驱动，之后也不需要改回来）</p>
<div class="hlcode"><pre><span class="n">blacklist</span> <span class="n">nouveau</span>
<span class="n">options</span> <span class="n">nouveau</span> <span class="n">modeset</span><span class="o">=</span><span class="mi">0</span>
</pre></div>


<p>然后执行：<code>sudo update-initramfs -u</code>, 重新生成 kernel initramfs</p>
<p>重启后，执行：lsmod | grep nouveau。如果没有屏幕输出，说明禁用nouveau成功。</p>
<p>4、禁用X-Window服务</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">service</span> <span class="n">lightdm</span> <span class="n">stop</span> <span class="err">#这会关闭图形界面，但不用紧张</span>
</pre></div>


<p>按Ctrl-Alt+F1进入命令行界面，输入用户名和密码登录即可。</p>
<p><strong>小提示</strong>：在命令行输入：sudo service lightdm start ，然后按Ctrl-Alt+F7即可恢复到图形界面。<br />
5、命令行安装驱动</p>
<div class="hlcode"><pre><span class="cp">#给驱动run文件赋予执行权限：</span>
<span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">NVIDIA</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">384.59</span><span class="p">.</span><span class="n">run</span>
<span class="cp">#后面的参数非常重要，不可省略：</span>
<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">NVIDIA</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">384.59</span><span class="p">.</span><span class="n">run</span> <span class="err">–</span><span class="n">no</span><span class="o">-</span><span class="n">opengl</span><span class="o">-</span><span class="n">files</span>
</pre></div>


<ul>
<li>–no-x-check：表示安装驱动时不检查X服务，非必需。</li>
<li>–no-nouveau-check：表示安装驱动时不检查nouveau，非必需。</li>
<li>-Z, --disable-nouveau：禁用nouveau。此参数非必需，因为之前已经手动禁用了nouveau。</li>
<li>-A：查看更多高级选项。</li>
</ul>
<p>必选参数解释：因为NVIDIA的驱动默认会安装OpenGL，而Ubuntu的内核本身也有OpenGL、且与GUI显示息息相关，一旦NVIDIA的驱动覆写了OpenGL，在GUI需要动态链接OpenGL库的时候就引起问题。之后，按照提示安装，成功后重启即可。 <br />
如果提示安装失败，不要急着重启电脑，重复以上步骤，多安装几次即可。</p>
<p>Driver测试：</p>
<div class="hlcode"><pre><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span> <span class="err">#若列出</span><span class="n">GPU</span><span class="err">的信息列表，表示驱动安装成功</span>
<span class="n">nvidia</span><span class="o">-</span><span class="n">settings</span> <span class="err">#若弹出设置对话框，亦表示驱动安装成功</span>
</pre></div>


<h1 id="cuda">二、安装cuda</h1>
<h4 id="1nouveau-nvidia">1、检查自带的nouveau nvidia驱动是否禁用。</h4>
<p>如果安装cuda和安装显卡驱动没有同时进行，则需要检查这一步，同样安装cuda和显卡驱动都需要禁用nouveau驱动。</p>
<h4 id="2ctrl-alt-f1">2、<code>Ctrl + Alt + F1</code> 进入命令行模式，执行，</h4>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">service</span> <span class="n">lightdm</span> <span class="n">stop</span>      <span class="c1">// 关闭桌面服务</span>
</pre></div>


<p>在安装CUDA的过程中必须得关闭桌面服务。</p>
<p>当然，你也可以在终端中执行关闭桌面服务操作，然后使用 <code>Ctrl + Alt + F1</code> 登陆你的账号。我在安装的过程中是先关闭桌面服务然后使用<code>Ctrl + Alt + F1</code>进入终端然后重新登陆账号密码的。</p>
<p><strong>注，在安装nvidia显卡驱动和cuda的时候都需要关闭桌面服务，或者可以在安装完显卡驱动之后不恢复图形界面，直接安装cuda。</strong></p>
<h4 id="3cudarun">3、安装CUDA.run文件</h4>
<p>我用的是是CUDA8.0的版本，刚开始安装的是最新9.0的版本，后来好像在某篇教程中看到tensorflow目前还不支持CUDA9.0版本的，所以重装了8.0的，也有可能我没有理解他的意思，我没有经过实测。还有就是很多教程直接使用.deb安装的CUDA，同事反应在升级的过程中直接安装没有问题，但是后面使用的时候就会出现一些问题，所以我也没有直接安装，后面遇到的问题也没办法复现。</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">sh</span> <span class="n">cuda_8</span><span class="mf">.0.61</span><span class="n">_375</span><span class="mf">.26</span><span class="n">_linux</span><span class="p">.</span><span class="n">run</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">opengl</span><span class="o">-</span><span class="n">libs</span>
</pre></div>


<p>在.run文件后面添加--no-opengl-libs的详解见<a href="https://www.cnblogs.com/gaowengang/p/6068788.html">Ubuntu 14.04 安装 CUDA 问题及解决</a>，安装完成后需要将opengl的相关lib重新安装一下。</p>
<p>运行之后会跳出readme文件，然后按住<code>Ctrl + C</code>跳过。然后会依次出现以下提示：</p>
<div class="hlcode"><pre><span class="n">Do</span> <span class="n">you</span> <span class="n">accept</span> <span class="n">the</span> <span class="n">previously</span> <span class="n">read</span> <span class="n">EULA</span><span class="err">，</span>  <span class="err">输入</span> <span class="n">accept</span><span class="err">，进入下一步。</span>
<span class="n">INSTALL</span> <span class="n">NVIDIA</span> <span class="n">Accelerates</span> <span class="n">Graphics</span> <span class="n">Driver</span> <span class="k">for</span> <span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span> <span class="mf">375.26</span><span class="err">，</span>  <span class="err">输入</span><span class="n">n</span><span class="err">，进入下一步；</span>
<span class="n">Install</span> <span class="n">the</span>  <span class="n">CUDA</span> <span class="mf">8.0</span> <span class="n">Toolkit</span><span class="o">?</span><span class="err">，</span>  <span class="err">输入</span><span class="n">y</span><span class="err">，</span> <span class="err">进入下一步；</span>
<span class="n">Enter</span> <span class="n">Tookit</span> <span class="n">Location</span> <span class="err">点击</span><span class="n">enter</span><span class="err">，</span> <span class="err">进入下一步；</span>
<span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">install</span> <span class="n">a</span> <span class="n">symbolic</span> <span class="n">link</span> <span class="n">at</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="err">，</span>  <span class="err">输入</span><span class="n">y</span><span class="err">，进入下一步；</span>
<span class="n">Install</span> <span class="n">the</span> <span class="n">CUDA</span> <span class="mf">8.0</span> <span class="n">Samples</span><span class="o">?</span>  <span class="err">输入</span><span class="n">y</span><span class="err">，</span> <span class="err">进入下一步；</span>
<span class="n">Enter</span> <span class="n">CUDA</span> <span class="n">Samples</span> <span class="n">Location</span> <span class="err">点击</span><span class="n">enter</span><span class="err">，</span> <span class="err">进入下一步；</span>
<span class="err">程序开始安装。。。</span>
</pre></div>


<p>更详细的提示见<a href="https://segmentfault.com/a/1190000008234390">Ubuntu16.04 下安装GPU版TensorFlow（包括Cuda和Cudnn）</a></p>
<p>安装完成之后，会提示一个summary；大致内容如下。</p>
<div class="hlcode"><pre><span class="n">Driver</span><span class="o">:</span> <span class="n">Not</span> <span class="n">Selectd</span>
<span class="n">Toolkit</span><span class="o">:</span> <span class="n">INstalled</span> <span class="k">in</span> <span class="sr">/usr/local/</span><span class="n">cuda</span><span class="o">-</span><span class="mf">8.0</span>
<span class="n">Samples</span><span class="o">:</span> <span class="n">Installed</span> <span class="k">in</span> <span class="sr">/home/</span><span class="n">jerry</span><span class="o">,</span> <span class="n">but</span> <span class="n">missing</span> <span class="n">recommended</span> <span class="n">libraries</span>
</pre></div>


<p><strong><em>注意</em></strong><br />
这时候会有一个提示，类似于下图，fail的原因是CUDA Driver没有安装。也有人说是因为双显卡(独立显卡和集成显卡)的原因。<br />
<center><img src="/wiki/static/images/tensorgpu/devicequeryerror.png" alt="devicequeryerror"/></center><br />
程序下面又一个warning：</p>
<div class="hlcode"><pre><span class="o">***</span><span class="nx">WARNING</span><span class="p">:</span> <span class="nx">Incomplete</span> <span class="nx">installation</span><span class="o">!</span> <span class="nx">This</span> <span class="nx">installation</span> <span class="nx">did</span> <span class="ow">not</span> <span class="nb">install</span> <span class="nx">the</span> <span class="nx">CUDA</span> <span class="nx">Driver.</span> <span class="nx">A</span> <span class="nx">driver</span> <span class="nx">of</span> <span class="nb">version</span> <span class="nx">at</span> <span class="nx">least</span> <span class="mf">361.00</span> <span class="nx">is</span> <span class="nx">required</span> <span class="nb">for</span> <span class="nx">CUDA</span> <span class="mf">8.0</span> <span class="nx">functionality</span> <span class="k">to</span> <span class="nx">work.</span>
<span class="k">To</span> <span class="nb">install</span> <span class="nx">the</span> <span class="nx">driver</span> <span class="nx">using</span> <span class="nx">this</span> <span class="nx">installer</span><span class="p">,</span> <span class="nb">run</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nb">command</span><span class="p">,</span> <span class="nx">replacing</span> <span class="o">&lt;</span><span class="nx">CudaInstaller</span><span class="o">&gt;</span> <span class="k">with</span> <span class="nx">the</span> <span class="nb">name</span> <span class="nx">of</span> <span class="nx">this</span> <span class="nb">run</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nx">sudo</span> <span class="o">&lt;</span><span class="nx">CudaInstaller</span><span class="o">&gt;</span><span class="bp">.</span><span class="nb">run</span> <span class="na">-silent</span> <span class="na">-driver</span>
</pre></div>


<p>根据warning提示，在.run文件后面添加-silent -driver，有提示的图片忘记保存了。以后遇到在加上。</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">sh</span> <span class="n">cuda_8</span><span class="mf">.0.61</span><span class="n">_375</span><span class="mf">.26</span><span class="n">_linux</span><span class="p">.</span><span class="n">run</span> <span class="o">-</span><span class="n">silent</span> <span class="o">-</span><span class="n">driver</span>
</pre></div>


<p>安装完成之后，启动桌面</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">service</span> <span class="n">lightdm</span> <span class="n">start</span>     <span class="c1">// 重启桌面服务</span>
</pre></div>


<p>为了检查安装是否正确，从cuda的samples中选择样例进行测试。</p>
<div class="hlcode"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">-</span><span class="mf">7.5</span><span class="o">/</span><span class="n">samples</span><span class="o">/</span><span class="mi">1</span><span class="n">_Utilities</span><span class="o">/</span><span class="n">deviceQuery</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">clean</span> <span class="o">&amp;&amp;</span> <span class="n">make</span>
<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">deviceQuery</span>
</pre></div>


<p><strong>注意，我在升级tensorflow至1.7后，此时cuda需要升级到cuda9.0,在安装cuda9.0的过程中，Driver显示的是Not Selectd，但是使用<code>sudo &lt;CudaInstaller&gt;.run -silent -driver</code>的方式并没有能够安装成功。但是我在使用samples中的样例测试也是可以的，没有出问题。所以这边Driver有没有select好像没有什么区别。对后面安装cudnn和tensorflow-gpu都没有什么影响。后面没有出现问题，所以也就没有去解决。(更新时间4月18日)</strong></p>
<p>如果显示的是一些关于GPU的信息，则说明安装成功了，详细信息见下图。<br />
<center><img src="/wiki/static/images/tensorgpu/devicequery.png" alt="devicequery"/></center></p>
<h2 id="_2">配置环境变量</h2>
<p>在CUDA安装完成之后，log日志中有提示需要声明环境变量，不然后面安装cudnn时会出现找不到.so文件。所以需要在/etc/profile中添加下面的内容。</p>
<div class="hlcode"><pre><span class="n">PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">bin</span><span class="o">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">PATH</span>
<span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="err">$</span><span class="n">LD_LIBRARY_PATH</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">lib64</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span>
</pre></div>


<p>最后<code>source /etc/profile</code>即可。</p>
<h1 id="cudnn">三、安装cudnn</h1>
<p>在CUDA安装好之后，CUDNN安装相对比较容易，根据官网教程，首先从官网上下载四个文件。</p>
<div class="hlcode"><pre><span class="n">cudnn</span><span class="o">-</span><span class="mf">8.0</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">-</span><span class="n">v7</span><span class="p">.</span><span class="n">tgz</span>

<span class="n">libcudnn7_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>

<span class="n">libcudnn7</span><span class="o">-</span><span class="n">dev_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>

<span class="n">libcudnn7</span><span class="o">-</span><span class="n">doc_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
</pre></div>


<p><strong><em>注意</em></strong><br />
在安装cudnn的时候要特别注意tensorflow目前支持的cudnn版本，我这边直接下载的是最新的，后面在安装完tensorflow-gpu 1.4.1之后调用cudnn时就出现了错误，错误提示为ImportError: libcudnn.so.6: cannot open shared object file: No such file or directory。<br />
我的解决方法是从官网上直接下载cudnn.6.0版本的，至于软链接等方式我试过了没有成功，后面有详细介绍，也可能是我添加环境变量错误导致。</p>
<p>根据对应的系统和cuda版本下载，我的系统是ubuntu16.04，cuda版本为8.0.最好再注意下tensorflow支持的cudnn版本，然后需要注意的是cuda的安装路径，如果在安装cuda使用的默认路径/usr/local/cuda/，则不需要修改。</p>
<p>在存放四个文件的下载目录下。</p>
<div class="hlcode"><pre><span class="cp"># 解压 cuDNN package.</span>
<span class="err">$</span> <span class="n">tar</span> <span class="o">-</span><span class="n">xzvf</span> <span class="n">cudnn</span><span class="o">-</span><span class="mf">8.0</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">-</span><span class="n">v7</span><span class="p">.</span><span class="n">tgz</span>
<span class="cp"># 将下面的文件复制到 CUDA Toolkit 文件目录下。</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">cp</span> <span class="n">cuda</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">cudnn</span><span class="p">.</span><span class="n">h</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">include</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">cp</span> <span class="n">cuda</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libcudnn</span><span class="o">*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">lib64</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">r</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">cudnn</span><span class="p">.</span><span class="n">h</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libcudnn</span><span class="o">*</span>
<span class="cp"># 安装 runtime library,</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">libcudnn7_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
<span class="cp"># 安装 developer library,</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">libcudnn7</span><span class="o">-</span><span class="n">dev_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
<span class="cp"># 安装 code samples and the cuDNN Library User Guide</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">libcudnn7</span><span class="o">-</span><span class="n">doc_7</span><span class="mf">.0.5.15</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">cuda8</span><span class="mf">.0</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
</pre></div>


<h2 id="cudnn_1">验证cudnn是否安装正确</h2>
<div class="hlcode"><pre><span class="mf">1.</span> <span class="err">将某一个</span> <span class="n">cuDNN</span> <span class="err">样例复制到某一可读写文件目录下</span>
<span class="err">$</span> <span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">cudnn_samples_v7</span><span class="o">/</span> <span class="err">$</span><span class="n">HOME</span>
<span class="mf">2.</span> <span class="err">进入该文件目录，</span> <span class="err">本文选择的是</span><span class="n">mnistCUDNN</span><span class="err">测试</span>
<span class="err">$</span> <span class="n">cd</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">cudnn_samples_v7</span><span class="o">/</span><span class="n">mnistCUDNN</span>
<span class="mf">3.</span> <span class="err">编译</span> <span class="n">mnistCUDNN</span> <span class="err">样例</span><span class="p">.</span>
<span class="err">$</span> <span class="n">make</span> <span class="n">clean</span> <span class="o">&amp;&amp;</span> <span class="n">make</span>
<span class="mf">4.</span> <span class="err">运行</span> <span class="n">mnistCUDNN</span> <span class="err">样例</span><span class="p">.</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">mnistCUDNN</span>
<span class="mf">5.</span> <span class="err">如果安装成功，程序的最后则会显示</span>
<span class="n">Test</span> <span class="n">passed</span><span class="o">!</span>
</pre></div>


<p>详细运行结果如下图所示：<br />
<center><img src="/wiki/static/images/tensorgpu/mnist.png" alt="mnist"/></center></p>
<h1 id="gputensorflow">四、安装gpu版tensorflow</h1>
<p>本文使用的是virtualenv安装的tensorflow。<br />
现在tensorflow越来越成熟了，所以在虚拟环境下直接可以用<code>pip install --upgrade tensorflow-gpu</code>即可安装成功。<br />
安装完成后，进入python环境测试一下，问题来了。</p>
<h3 id="_3">错误提示</h3>
<div class="hlcode"><pre><span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nb">call</span> <span class="nb">last</span><span class="p">):</span>
  <span class="nb">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">1</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/__init__.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">24</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nb">from</span> <span class="nx">tensorflow.python</span> <span class="k">import</span> <span class="o">*</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/python/__init__.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">49</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nb">from</span> <span class="nx">tensorflow.python</span> <span class="k">import</span> <span class="nx">pywrap_tensorflow</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/python/pywrap_tensorflow.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">59</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nx">raise</span> <span class="nx">ImportError</span><span class="p">(</span><span class="nb">msg</span><span class="p">)</span>
<span class="nx">ImportError</span><span class="p">:</span> <span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nb">call</span> <span class="nb">last</span><span class="p">):</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/python/pywrap_tensorflow.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">48</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nb">from</span> <span class="nx">tensorflow.python.pywrap_tensorflow_internal</span> <span class="k">import</span> <span class="o">*</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/python/pywrap_tensorflow_internal.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">28</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="n">_pywrap_tensorflow_internal</span> <span class="o">=</span> <span class="nx">swig_import_helper</span><span class="p">()</span>
  <span class="nb">File</span> <span class="s2">&quot;/home/jerry/workshop/virtualenv/tensor/local/lib/python2.7/site-packages/tensorflow/python/pywrap_tensorflow_internal.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">24</span><span class="p">,</span> <span class="k">in</span> <span class="nx">swig_import_helper</span>
    <span class="n">_mod</span> <span class="o">=</span> <span class="nx">imp.load_module</span><span class="p">(</span><span class="s1">&#39;_pywrap_tensorflow_internal&#39;</span><span class="p">,</span> <span class="nx">fp</span><span class="p">,</span> <span class="nx">pathname</span><span class="p">,</span> <span class="nb">description</span><span class="p">)</span>
<span class="nx">ImportError</span><span class="p">:</span> <span class="nx">libcudnn.so.6</span><span class="p">:</span> <span class="nx">cannot</span> <span class="nb">open</span> <span class="nx">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="nx">No</span> <span class="nx">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="nx">directory</span>


<span class="nx">Failed</span> <span class="k">to</span> <span class="nx">load</span> <span class="nx">the</span> <span class="nx">native</span> <span class="nx">TensorFlow</span> <span class="nx">runtime.</span>

<span class="nx">See</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.tensorflow.org/install/install_sources#common_installation_problems</span>

<span class="nb">for</span> <span class="nx">some</span> <span class="nx">common</span> <span class="nx">reasons</span> <span class="ow">and</span> <span class="nx">solutions.</span>  <span class="nb">Include</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nb">stack</span> <span class="nb">trace</span>
<span class="nx">above</span> <span class="nx">this</span> <span class="nb">error</span> <span class="nx">message</span> <span class="nx">when</span> <span class="nx">asking</span> <span class="nb">for</span> <span class="nx">help.</span>
</pre></div>


<p>在网上查资料发现，需要进行软链接配置，主要原因依然是环境变量的问题，但是按照一些方式还是提示上面的错误，后来查看lib64下面的文件发现我安装的是.so.8.0的版本，本来是想都安装最新版本的，慢慢发现google和nvidia两家根本不同步，版本的一致性问题很头疼。没办法，在nvidia官网重新下载6.0版本的cudnn按照上面的方式重新安装后，在没有重新设置环境变量的情况下，helloword程序跑通了<br />
下面是执行session时输出的信息，GPU信息显示出来了。</p>
<div class="hlcode"><pre><span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">13</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">43.894722</span><span class="o">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">cpu_feature_guard</span><span class="p">.</span><span class="n">cc</span><span class="o">:</span><span class="mi">137</span><span class="p">]</span> <span class="n">Your</span> <span class="n">CPU</span> <span class="n">supports</span> <span class="n">instructions</span> <span class="n">that</span> <span class="n">this</span> <span class="n">TensorFlow</span> <span class="n">binary</span> <span class="n">was</span> <span class="n">not</span> <span class="n">compiled</span> <span class="n">to</span> <span class="n">use</span><span class="o">:</span> <span class="n">SSE4</span><span class="mf">.1</span> <span class="n">SSE4</span><span class="mf">.2</span> <span class="n">AVX</span> <span class="n">AVX2</span> <span class="n">FMA</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">13</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">44.024230</span><span class="o">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">cuda_gpu_executor</span><span class="p">.</span><span class="n">cc</span><span class="o">:</span><span class="mi">892</span><span class="p">]</span> <span class="n">successful</span> <span class="n">NUMA</span> <span class="n">node</span> <span class="n">read</span> <span class="n">from</span> <span class="n">SysFS</span> <span class="n">had</span> <span class="n">negative</span> <span class="n">value</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">but</span> <span class="n">there</span> <span class="n">must</span> <span class="n">be</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">NUMA</span> <span class="n">node</span><span class="p">,</span> <span class="n">so</span> <span class="n">returning</span> <span class="n">NUMA</span> <span class="n">node</span> <span class="n">zero</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">13</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">44.024467</span><span class="o">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">common_runtime</span><span class="o">/</span><span class="n">gpu</span><span class="o">/</span><span class="n">gpu_device</span><span class="p">.</span><span class="n">cc</span><span class="o">:</span><span class="mi">1030</span><span class="p">]</span> <span class="n">Found</span> <span class="n">device</span> <span class="mi">0</span> <span class="n">with</span> <span class="n">properties</span><span class="o">:</span>
<span class="nl">name:</span> <span class="n">GeForce</span> <span class="n">GTX</span> <span class="mi">1080</span> <span class="n">major</span><span class="o">:</span> <span class="mi">6</span> <span class="n">minor</span><span class="o">:</span> <span class="mi">1</span> <span class="n">memoryClockRate</span><span class="p">(</span><span class="n">GHz</span><span class="p">)</span><span class="o">:</span> <span class="mf">1.7335</span>
<span class="nl">pciBusID:</span> <span class="mo">0000</span><span class="o">:</span><span class="mo">01</span><span class="o">:</span><span class="mf">00.0</span>
<span class="nl">totalMemory:</span> <span class="mf">7.92</span><span class="n">GiB</span> <span class="n">freeMemory</span><span class="o">:</span> <span class="mf">7.34</span><span class="n">GiB</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">13</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">44.024480</span><span class="o">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">common_runtime</span><span class="o">/</span><span class="n">gpu</span><span class="o">/</span><span class="n">gpu_device</span><span class="p">.</span><span class="n">cc</span><span class="o">:</span><span class="mi">1120</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">TensorFlow</span> <span class="n">device</span> <span class="p">(</span><span class="o">/</span><span class="n">device</span><span class="o">:</span><span class="n">GPU</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">device</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">:</span> <span class="n">GeForce</span> <span class="n">GTX</span> <span class="mi">1080</span><span class="p">,</span> <span class="n">pci</span> <span class="n">bus</span> <span class="n">id</span><span class="o">:</span> <span class="mo">0000</span><span class="o">:</span><span class="mo">01</span><span class="o">:</span><span class="mf">00.0</span><span class="p">,</span> <span class="n">compute</span> <span class="n">capability</span><span class="o">:</span> <span class="mf">6.1</span><span class="p">)</span>
</pre></div>


<p>具体运行结果如下图所示：<br />
<center><img src="/wiki/static/images/tensorgpu/tensorflow.png" alt="tensorflow"/></center></p>
<p>至此，基于Ubuntu的tensorflow-gpu版本就安装配置完成，下面就可以畅快的"吃鸡"啦。</p>
<h1 id="_4">五、一些问题</h1>
<h3 id="1">1、驱动问题</h3>
<p>我在安装过程中涉及到两个驱动问题，一个是显卡驱动，还有一个是CUDA驱动。<strong><em>显卡驱动</em></strong>我直接先是使用<code>sudo apt-get install upgrade</code>升级安装包，然后在Ubuntu的设置里面更新的Nvidia显卡驱动。并没有从官网下载安装对应版本的显卡驱动。<strong><em>CUDA驱动</em></strong>，我最初在安装CUDA的时候选项全部选择的是yes，导致最后的Driver、Toolkit和Samples都没有安装成功，后来所有教程中都加第二步是否安装图形显卡驱动时选择No，按照教程设置后Toolkit和Samples都安装成功了，但是Driver先是没有选择，安装结束后有一个warning，CUDA的驱动没有安装，根据提示在CUDA.run文件后面添加<code>-silent -driver</code>之后,对应的log文件中会先是<code>Driver: Installed</code>.</p>
<h3 id="2cuda">2、关于cuda环境变量和更新软链接问题</h3>
<p>最终在我的/etc/profile下面添加的内容如下：</p>
<div class="hlcode"><pre><span class="n">PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">/</span><span class="n">bin</span><span class="o">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">PATH</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s">&quot;$LD_LIBRARY_PATH:/usr/local/cuda-8.0/lib64:/usr/local/cuda-8.0/extras/CUPTI/lib64&quot;</span>
<span class="n">export</span> <span class="n">CUDA_HOME</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cuda</span><span class="o">-</span><span class="mf">8.0</span>
</pre></div>


<p>我也没用到软链接之类的。</p>
<h3 id="3failed-call-to-cuinit-cuda_error_unknown">3、failed call to cuInit: CUDA_ERROR_UNKNOWN</h3>
<p>在系统能够正常运行的情况下，轻易不要去更新显卡驱动，Nvidia动不动就会出新的驱动更新，我建议是不是大版本更新，能不更新尽量不更新，我就遇到了问题，每次登录系统的时候系统都会提示例如几个packages can be update，我觉得碍眼就直接使用<code>sudo apt-get upgrade</code>升级安装包，突然发现她在帮我更新显卡驱动，虎躯一震，感觉要出问题。等更新完成之后我立刻运行我的tensorflow程序，问题真的来了。<br />
问题提示""failed call to cuInit: CUDA_ERROR_UNKNOWN""<br />
<center><img src="/wiki/static/images/tensorgpu/cuda_error.png" alt="CUDA_ERROR_UNKNOWN"/></center><br />
网上的解决方法：<br />
第一种解决方法是 <code>sudo apt-get install nvidia-modprobe</code>，我尝试了，好像没有用。还是会报同样的错误。<br />
第二种解决方法是 直接使用<code>sudo</code>来运行程序。具体可以参考<a href="https://github.com/tensorflow/tensorflow/issues/394">failed call to cuInit: CUDA_ERROR_UNKNOWN in python programs using Ubuntu bumblebee</a>。</p>
<p>内核版本不匹配，那我就按照上面的方式重装cuda。<br />
重装之后运行程序,问题解决<br />
<center><img src="/wiki/static/images/tensorgpu/cuda_right.jpg" alt="CUDA_right"/></center></p>
<h3 id="4lib">4、添加lib库路径</h3>
<h2 id="_5">后续</h2>
<p>tensorflow升级至1.7版本后，如果继续使用cuda 8.0则会报下面的错误：</p>
<div class="hlcode"><pre><span class="o">---------------------------------------------------------------------------</span>
<span class="nx">ImportError</span>                               <span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nb">call</span> <span class="nb">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="nx">ipython</span><span class="na">-input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">64156</span><span class="nx">d691fe5</span><span class="o">&gt;</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">import</span> <span class="nx">tensorflow</span> <span class="nx">as</span> <span class="nx">tf</span>

<span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">__init__.py</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span><span class="p">()</span>
     <span class="mi">22</span> 
     <span class="mi">23</span> <span class="err">#</span> <span class="nx">pylint</span><span class="p">:</span> <span class="n">disable</span><span class="o">=</span><span class="nx">wildcard</span><span class="na">-import</span>
<span class="o">---&gt;</span> <span class="mi">24</span> <span class="nb">from</span> <span class="nx">tensorflow.python</span> <span class="k">import</span> <span class="o">*</span>  <span class="err">#</span> <span class="nx">pylint</span><span class="p">:</span> <span class="n">disable</span><span class="o">=</span><span class="nx">redefined</span><span class="na">-builtin</span>
     <span class="mi">25</span> <span class="err">#</span> <span class="nx">pylint</span><span class="p">:</span> <span class="n">enable</span><span class="o">=</span><span class="nx">wildcard</span><span class="na">-import</span>
     <span class="mi">26</span> 

<span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">python</span><span class="p">/</span><span class="nx">__init__.py</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span><span class="p">()</span>
     <span class="mi">47</span> <span class="k">import</span> <span class="nx">numpy</span> <span class="nx">as</span> <span class="nx">np</span>
     <span class="mi">48</span> 
<span class="o">---&gt;</span> <span class="mi">49</span> <span class="nb">from</span> <span class="nx">tensorflow.python</span> <span class="k">import</span> <span class="nx">pywrap_tensorflow</span>
     <span class="mi">50</span> 
     <span class="mi">51</span> <span class="err">#</span> <span class="nx">Protocol</span> <span class="nx">buffers</span>

<span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">python</span><span class="p">/</span><span class="nx">pywrap_tensorflow.py</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span><span class="p">()</span>
     <span class="mi">72</span> <span class="nb">for</span> <span class="nx">some</span> <span class="nx">common</span> <span class="nx">reasons</span> <span class="ow">and</span> <span class="nx">solutions.</span>  <span class="nb">Include</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nb">stack</span> <span class="nb">trace</span>
     <span class="mi">73</span> <span class="nx">above</span> <span class="nx">this</span> <span class="nb">error</span> <span class="nx">message</span> <span class="nx">when</span> <span class="nx">asking</span> <span class="nb">for</span> <span class="nx">help.</span><span class="s2">&quot;&quot;&quot; % traceback.format_exc()</span>
<span class="s2">---&gt; 74   raise ImportError(msg)</span>
<span class="s2">     75 </span>
<span class="s2">     76 # pylint: enable=wildcard-import,g-import-not-at-top,unused-import,line-too-long</span>

<span class="s2">ImportError: Traceback (most recent call last):</span>
<span class="s2">  File &quot;</span><span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">python</span><span class="p">/</span><span class="nx">pywrap_tensorflow.py</span><span class="s2">&quot;, line 58, in &lt;module&gt;</span>
<span class="s2">    from tensorflow.python.pywrap_tensorflow_internal import *</span>
<span class="s2">  File &quot;</span><span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">python</span><span class="p">/</span><span class="nx">pywrap_tensorflow_internal.py</span><span class="s2">&quot;, line 28, in &lt;module&gt;</span>
<span class="s2">    _pywrap_tensorflow_internal = swig_import_helper()</span>
<span class="s2">  File &quot;</span><span class="p">/</span><span class="nb">home</span><span class="p">/</span><span class="nx">jerry</span><span class="p">/</span><span class="nx">workshop</span><span class="p">/</span><span class="nx">virtualenv</span><span class="p">/</span><span class="nx">tensor_jupyer</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">python2.7</span><span class="p">/</span><span class="nx">site</span><span class="na">-packages</span><span class="p">/</span><span class="nx">tensorflow</span><span class="p">/</span><span class="nx">python</span><span class="p">/</span><span class="nx">pywrap_tensorflow_internal.py</span><span class="s2">&quot;, line 24, in swig_import_helper</span>
<span class="s2">    _mod = imp.load_module(&#39;_pywrap_tensorflow_internal&#39;, fp, pathname, description)</span>
<span class="s2">ImportError: libcublas.so.9.0: cannot open shared object file: No such file or directory</span>

<span class="s2">Failed to load the native TensorFlow runtime.</span>

<span class="s2">See https://www.tensorflow.org/install/install_sources#common_installation_problems</span>

<span class="s2">for some common reasons and solutions.  Include the entire stack trace</span>
<span class="s2">above this error message when asking for help.</span>
</pre></div>


<p>也就是说 tensorflow兼容的cuda也已经升级至9.0了，下面介绍下在ubuntu 16.04下升级安装cuda 9.0，这里本来想在cuda8.0的基础上直接覆盖安装cuda9.0的，结果没有成功，编译cuda实例源码的时候使用提示没有找到driver。在这之前一直是使用ubuntu系统本身的升级系统来更新nvidia驱动的，并没有使用源码安装显卡驱动。后来不停的重装cuda的过程中反而把系统给弄坏了，最后实在没办法重装系统。</p>
<p><strong>在这里我又跳到坑里了，tensorflow 1.7目前暂时不支持cudnn9.1，所以我又得重新安装cudnn了（4月17号更新）</strong><br />
<strong>注意，在安装cuda和dudnn的时候版本一定要一致。重装系统后，我装了cuda_9.0.176_384.81_linux和cudnn-9.0-linux-x64-v7.1，tensorflow的版本为1.7.0，安装过程中没有出现什么太大的问题，基本跟cuda8.0安装过程差不多。</strong></p>
<h1 id="_6">六、参考文献</h1>
<p><a href="https://www.cnblogs.com/gaowengang/p/6068788.html">Ubuntu 14.04 安装 CUDA 问题及解决</a><br />
<a href="http://blog.csdn.net/autocyz/article/details/52299889/">Ubuntu16.04+cuda8.0+caffe安装教程</a><br />
<a href="http://developer2.download.nvidia.com/compute/machine-learning/cudnn/secure/v7.0.5/prod/Doc/cuDNN-Installation-Guide.pdf?1RL9HfeGELbC3I_J6F0c5RpXvy64oKHaWa0lZVIHWvzPbVKxDtV4_ivmxT2kIC6z1lE_h2bxuVgKEhGGW6R5n_GHnem5SFsA9jQI6LWMt68_sjV_HuOFBYO3EHzSwncT9iu1uUqar7UMgfrEOjgjE6hYCZcNNzBLgWrFa5VCRa2DsE1G8htULohvZqErOvFXRw">CUDNN Installation Guide</a><br />
<a href="https://segmentfault.com/a/1190000008234390">Ubuntu16.04 下安装GPU版TensorFlow（包括Cuda和Cudnn）</a><br />
<a href="http://blog.csdn.net/u014696921/article/details/60140264">"libcudnn.so.5 cannot open shared object file: No such file or directory" </a><br />
<a href="http://blog.csdn.net/liukun321/article/details/6908635">ldconfig提示is not a symbolic link警告的去除方法 </a><br />
<a href="http://blog.csdn.net/binglel/article/details/70230276">Ubuntu16.04.1如何安装TensorFlow1.1.0（GPU版）</a><br />
<a href="https://github.com/tensorflow/tensorflow/issues/394">failed call to cuInit: CUDA_ERROR_UNKNOWN in python programs using Ubuntu bumblebee</a></p>
</div>
<div id="content-footer">created in <span class="create-date date"> 2017-12-12 14:00 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  title: '分布式TensorFlow搭建和使用',
  owner: 'sthsf',
  repo: 'wiki',
  oauth: {
    client_id: '086c54c5fd95adfdc372',
    client_secret: '2ad9ebe87b952d2c77fccf99c334881b91eaa73d',
  },
  // ...
  // For more available options, check out the documentation below
})
gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

</div>
<div id="footer">
            <span>
                Copyright © 2018 LiYu.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/sthsf/wiki" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?90e1dcdd1938573c19f9ff6521188e91";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>