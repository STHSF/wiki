<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>DokcerFile编写教程 - LiYu's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Economics"/>
    <meta name="description" content="A wiki website of sthsf when I learned new knowledgy and technics."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Linux Tricks">Linux Tricks</a>&nbsp;»&nbsp;DokcerFile编写教程</div>
</div>
<div class="clearfix"></div>
<div id="title">DokcerFile编写教程</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">写在前面</a></li>
<li><a href="#1">1、基础镜像</a><ul>
<li><a href="#dockerfile">基础镜像的Dockerfile</a></li>
</ul>
</li>
<li><a href="#2">2、项目镜像</a></li>
<li><a href="#3">3、容器管理</a></li>
<li><a href="#4kubernetes">4、kubernetes管理容器</a></li>
<li><a href="#_2">参考文献</a></li>
</ul>
</div>
<h1 id="_1">写在前面</h1>
<h1 id="1">1、基础镜像</h1>
<p>基础镜像是镜像中运行的项目或者启动的一些服务，都要在一个基础镜像之上才能运行这些服务，比如一个django项目或者mysql数据库等，都要在Linux操作系统之上来运行，所以打包我们自己的项目时，必须要有个基础镜像来当作我们项目运行的基础环境。</p>
<p>基础镜像一般为某个linux操作系统, 比如centos, ubuntu等. 里面可以包含一些通用的服务, 比如python版本,等等</p>
<h2 id="dockerfile">基础镜像的Dockerfile</h2>
<p>首先我们看一下本地机器的文件目录如下:</p>
<div class="hlcode"><pre><span class="n">root</span><span class="err">@</span><span class="n">jerry</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span><span class="n">workshop</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">docker</span><span class="err">#</span> <span class="n">ll</span>
<span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Jul</span> <span class="mi">18</span> <span class="mi">20</span><span class="o">:</span><span class="mi">08</span> <span class="p">.</span><span class="o">/</span>
<span class="n">drwxrwxrwx</span> <span class="mi">31</span> <span class="n">jerry</span> <span class="n">jerry</span> <span class="mi">4096</span> <span class="n">Jul</span> <span class="mi">18</span> <span class="mi">20</span><span class="o">:</span><span class="mo">00</span> <span class="p">..</span><span class="o">/</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">root</span>  <span class="n">root</span>     <span class="mi">0</span> <span class="n">Jul</span> <span class="mi">18</span> <span class="mi">20</span><span class="o">:</span><span class="mo">01</span> <span class="n">Dockerfile</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Jul</span> <span class="mi">18</span> <span class="mi">20</span><span class="o">:</span><span class="mi">08</span> <span class="n">scripts</span><span class="o">/</span>
</pre></div>


<p>scripts/目录下保存的是run.sh文件, 文件内容为:</p>
<table class="hlcodetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="hlcode"><pre><span class="c">#!/bin/bash</span>

apt-get update
apt-get install -y gcc make <span class="se">\</span>
                -y wget <span class="se">\</span>
                -y net-tools <span class="se">\</span>
                -y inetutils-ping <span class="se">\</span>
                -y apt-utils
<span class="c">#python3.5</span>
wget https://www.python.org/ftp/python/3.5.4/Python-3.5.4.tgz
tar -zxvf Python-3.5.4.tgz
<span class="nb">cd </span>Python-3.5.4
./configure
make <span class="o">&amp;&amp;</span> make install

ln -s /usr/bin/python3 /usr/bin/python
rm -rf Python-3.5.4*

<span class="c">#pip3</span>
apt-get update <span class="o">&amp;&amp;</span> apt-get install -y  python3-pip
</pre></div>
</td></tr></table>

<p>实际上就是简单的安装python3和pip3的过程</p>
<p>下面是一个比较简单的Dockerfile, 主要功能是基于基础镜像, 在基础镜像的基础上执行run.sh中的内容.</p>
<div class="hlcode"><pre><span class="cp">#基础镜像为centos，版本为7，build镜像时会自动下载</span>
<span class="n">FROM</span> <span class="n">ubuntu</span><span class="o">:</span><span class="mf">16.04</span>

<span class="cp">#制作者信息</span>
<span class="n">MAINTAINER</span> <span class="n">liyu52577</span><span class="err">@</span><span class="mf">163.</span><span class="n">com</span>

<span class="cp">#设置环境变量</span>
<span class="n">ENV</span> <span class="n">CODE_DIR</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">workshop</span>
<span class="n">ENV</span> <span class="n">DOCKER_SCRIPTS</span><span class="o">=</span><span class="err">$</span><span class="n">CODE_DIR</span><span class="o">/</span><span class="n">base_image</span><span class="o">/</span><span class="n">scripts</span>

<span class="cp">#将scripts下的文件复制到镜像中的DOCKER_SCRIPTS目录</span>
<span class="n">COPY</span> <span class="p">.</span><span class="o">/</span><span class="n">scripts</span><span class="o">/*</span> <span class="err">$</span><span class="n">DOCKER_SCRIPTS</span><span class="o">/</span>

<span class="cp">#执行镜像中的provision.sh脚本</span>
<span class="n">RUN</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="err">$</span><span class="n">DOCKER_SCRIPTS</span><span class="o">/*</span>
<span class="n">RUN</span> <span class="err">$</span><span class="n">DOCKER_SCRIPTS</span><span class="o">/</span><span class="n">run</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>其中, run.sh脚本里面的内通, 当然,你也可以直接在dockerfile里面使用RUN编写一些安装过程</p>
<p>Dockerfile文件编写完成之后,执行下面的命令</p>
<div class="hlcode"><pre><span class="nx">docker</span> <span class="nx">build</span> <span class="na">-t</span> <span class="o">&lt;</span><span class="nx">REPOSITORY</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="kt">TAG</span><span class="o">&gt;</span>
</pre></div>


<p>这样,就可以生成一个基础镜像了.</p>
<p>当然, 也可以有另外的方式进行安装, 比如, 我们可以直接pull一个纯净的镜像, 然后启动镜像, 在contanier中执行所需要的安装, 安装完成之后可以直接push成image, 这个image跟上面Dockerfile启动的基本上应该没什么区别</p>
<h1 id="2">2、项目镜像</h1>
<p>基础镜像中包含了通用的一些信息, 这些信息大部分项目中都可能会用到, 或者需要跟某些正式环境中相互一致的信息, 而项目镜像中则需要根据不同项目的需求安装自己的库.比如某个项目需要使用到http和tcp服务等. 同时还可以把自己的项目代码通过Dockerfile复制到容器内, 熟练使用将会非常方便的部署Docker</p>
<p>项目镜像的Dockerfile：</p>
<div class="hlcode"><pre><span class="cp">#基础镜像</span>
<span class="n">FROM</span> <span class="n">ubuntu_base</span><span class="o">:</span><span class="mf">1.2</span>

<span class="cp">#语言编码设置</span>
<span class="n">RUN</span> <span class="n">localedef</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">f</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="o">-</span><span class="n">i</span> <span class="n">zh_CN</span> <span class="n">zh_CN</span><span class="p">.</span><span class="n">utf8</span>
<span class="n">ENV</span> <span class="n">LC_ALL</span> <span class="n">zh_CN</span><span class="p">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>

<span class="cp">#将项目目录文件复制到镜像中,CODE_DIR是在基础镜像中定义的</span>
<span class="n">COPY</span> <span class="p">.</span><span class="o">/</span><span class="n">jerry</span> <span class="err">$</span><span class="n">CODE_DIR</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span>

<span class="cp">#安装项目依赖包</span>
<span class="n">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="err">$</span><span class="n">CODE_DIR</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span><span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>

<span class="cp">#暴露端口</span>
<span class="n">EXPOSE</span> <span class="mi">8989</span>

<span class="cp">#启动项目</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s">&quot;python&quot;</span><span class="p">,</span> <span class="s">&quot;/opt/workshop/jerry/src/hello.py&quot;</span><span class="p">]</span>
</pre></div>


<h1 id="3">3、容器管理</h1>
<h1 id="4kubernetes">4、kubernetes管理容器</h1>
<h1 id="_2">参考文献</h1>
<p><a href="https://blog.csdn.net/wo18237095579/article/details/80540571">Docker Dockerfile 定制镜像</a></p>
<p><a href="https://blog.csdn.net/luanpeng825485697/article/details/81256680">将应用制作成镜像发布到服务器k8s上作为容器微服务运行</a></p>
<p><a href="https://blog.csdn.net/bocai_xiaodaidai/article/details/92838984">python项目打包成docker镜像并发布</a></p>
<p><a href="https://www.cnblogs.com/sammy1989/p/9406899.html">python项目代码打包成Docker镜像</a></p>
<p><a href=""></a></p>
</div>
<div id="content-footer">created in <span class="create-date date"> 2019-06-02 00:00 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  title: 'DokcerFile编写教程',
  owner: 'sthsf',
  repo: 'wiki',
  oauth: {
    client_id: '086c54c5fd95adfdc372',
    client_secret: '2ad9ebe87b952d2c77fccf99c334881b91eaa73d',
  },
  // ...
  // For more available options, check out the documentation below
})
gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

</div>
<div id="footer">
            <span>
                Copyright © 2019 LiYu.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/sthsf/wiki" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?90e1dcdd1938573c19f9ff6521188e91";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>