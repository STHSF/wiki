<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>airflow安装与使用 - LiYu's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Economics"/>
    <meta name="description" content="A wiki website of sthsf when I learned new knowledgy and technics."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Linux Tricks">Linux Tricks</a>&nbsp;»&nbsp;airflow安装与使用</div>
</div>
<div class="clearfix"></div>
<div id="title">airflow安装与使用</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">写在前面</a></li>
<li><a href="#dockerairflow">Docker下安装和配置airflow</a><ul>
<li><a href="#pip">通过pip安装</a></li>
<li><a href="#_2">配置</a><ul>
<li><a href="#_3">第一步, 初始化数据库(必须的步骤)</a></li>
<li><a href="#web">第二步,启动web服务</a></li>
<li><a href="#scheduler">第三步, 启动scheduler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mysql">连接宿主机的mysql</a><ul>
<li><a href="#mysql_1">宿主机安装mysql</a></li>
<li><a href="#airflow">airflow配置</a><ul>
<li><a href="#windows">windows下面</a></li>
<li><a href="#ubuntu">ubuntu下</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_4">附录</a><ul>
<li><a href="#explicit_defaults_for_timestamp">explicit_defaults_for_timestamp 错误</a></li>
</ul>
</li>
<li><a href="#_5">参考文献</a></li>
</ul>
</div>
<p><b><details><summary>写在前面</summary></b></p>
<h1 id="_1">写在前面</h1>
<p>本文主要介绍在docker下安装和配置airflow,并且访问外部(宿主机)的mysql.</p>
<p>Airflow是一个工作流分配管理系统,通过有向非循环图的方式管理任务流程, 设置任务依赖关系和时间调度.</p>
<p>Airflow独立于我们要运行的任务, 只需要把任务的名字和运行方式提供给airflow作为一个task就可以.</p>
<p></details></p>
<h1 id="dockerairflow">Docker下安装和配置airflow</h1>
<p>docker环境, ubuntu, python3.5</p>
<h3 id="pip">通过pip安装</h3>
<p>可以参照Airflow官网的<a href="https://airflow.apache.org/installation.html">tutorial</a></p>
<div class="hlcode"><pre><span class="n">pip</span> <span class="n">install</span> <span class="n">apache</span><span class="o">-</span><span class="n">airlfow</span>
</pre></div>


<p>默认安装的时候可能会出现下面的问题</p>
<div class="hlcode"><pre><span class="nx">Collecting</span> <span class="nx">apache</span><span class="na">-airflow</span>
  <span class="nx">Downloading</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//files.pythonhosted.org/packages/e4/06/45fe64a358ae595ac562640ce96a320313ff098eeff88afb3ca8293cb6b9/apache-airflow-1.10.2.tar.gz (5.2MB)</span>
    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">████████████████████████████████</span><span class="o">|</span> <span class="mf">5.2</span><span class="nx">MB</span> <span class="mf">7.6</span><span class="nx">MB</span><span class="p">/</span><span class="nb">s</span> 
    <span class="nx">Complete</span> <span class="nb">output</span> <span class="nb">from</span> <span class="nb">command</span> <span class="nx">python</span> <span class="nx">setup.py</span> <span class="nx">egg_info</span><span class="p">:</span>
    <span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nb">call</span> <span class="nb">last</span><span class="p">):</span>
      <span class="nb">File</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">1</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
      <span class="nb">File</span> <span class="s2">&quot;/tmp/pip-install-6ix8ukp0/apache-airflow/setup.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">429</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
        <span class="nx">do_setup</span><span class="p">()</span>
      <span class="nb">File</span> <span class="s2">&quot;/tmp/pip-install-6ix8ukp0/apache-airflow/setup.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">287</span><span class="p">,</span> <span class="k">in</span> <span class="nx">do_setup</span>
        <span class="nx">verify_gpl_dependency</span><span class="p">()</span>
      <span class="nb">File</span> <span class="s2">&quot;/tmp/pip-install-6ix8ukp0/apache-airflow/setup.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">53</span><span class="p">,</span> <span class="k">in</span> <span class="nx">verify_gpl_dependency</span>
        <span class="nx">raise</span> <span class="nx">RuntimeError</span><span class="p">(</span><span class="s2">&quot;By default one of Airflow&#39;s dependencies installs a GPL &quot;</span>
    <span class="nx">RuntimeError</span><span class="p">:</span> <span class="k">By</span> <span class="nb">default</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">Airflow</span><span class="s1">&#39;s dependencies installs a GPL dependency (unidecode). To avoid this dependency set SLUGIFY_USES_TEXT_UNIDECODE=yes in your environment when you install or upgrade Airflow. To force installing the GPL version set AIRFLOW_GPL_UNIDECODE</span>

<span class="s1">    ----------------------------------------</span>
<span class="s1">Command &quot;python setup.py egg_info&quot; failed with error code 1 in /tmp/pip-install-6ix8ukp0/apache-airflow/</span>
</pre></div>


<p>此时,在<code>~/.bashrc</code>中添加<code>export AIRFLOW_GPL_UNIDECODE=yes</code>,然后source一下bashrc即可.</p>
<h3 id="_2">配置</h3>
<p>如果没有做路径修改, Airflow的默认安装路径为<code>~/airflow</code></p>
<p>一般的,在使用pip安装成功之后,执行下面三个步骤,就可以使用airflow了.</p>
<p>默认安装下,airflow使用的是SequentialExecutor, 意思是只能通过顺次执行任务,</p>
<h4 id="_3">第一步, 初始化数据库(<strong><em>必须的步骤</em></strong>)</h4>
<p>每次修改配置文件之后,都需要初始化一次</p>
<div class="hlcode"><pre><span class="n">airflow</span> <span class="n">initdb</span>
</pre></div>


<p>在你运行任务之前,Airflow需要一个数据库来进行初始化, 如果你对airflow还不熟悉,airflow提供了sqlite,你直接恶意使用初始化的sqlite选项,<br />
初始化完成之后,你会在<code>~/airflow</code>目录下生成如下文件:</p>
<div class="hlcode"><pre><span class="n">total</span> <span class="mi">248</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span>   <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">22</span> <span class="mo">03</span><span class="o">:</span><span class="mi">25</span> <span class="p">.</span><span class="o">/</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span>   <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">22</span> <span class="mo">02</span><span class="o">:</span><span class="mi">26</span> <span class="p">..</span><span class="o">/</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span>  <span class="mi">22874</span> <span class="n">Mar</span> <span class="mi">22</span> <span class="mo">02</span><span class="o">:</span><span class="mi">26</span> <span class="n">airflow</span><span class="p">.</span><span class="n">cfg</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span> <span class="mi">212992</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">08</span><span class="o">:</span><span class="mi">23</span> <span class="n">airflow</span><span class="p">.</span><span class="n">db</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span>   <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">21</span> <span class="mi">08</span><span class="o">:</span><span class="mi">22</span> <span class="n">logs</span><span class="o">/</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">jerry</span> <span class="n">jerry</span>   <span class="mi">2447</span> <span class="n">Mar</span> <span class="mi">17</span> <span class="mi">09</span><span class="o">:</span><span class="mi">24</span> <span class="n">unittests</span><span class="p">.</span><span class="n">cfg</span>
</pre></div>


<p>你可以通过修改<code>airflow.cfg</code>文件修改相应的配置,例如默认数据库,任务的执行方式等.</p>
<h4 id="web">第二步,启动web服务</h4>
<p>为了方便可视化管理DAG, 可以启动airflow提供的webUI</p>
<div class="hlcode"><pre><span class="n">airflow</span> <span class="n">webserver</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span>
</pre></div>


<p>webserver 也可以不启动,对任务没有什么影响.</p>
<h4 id="scheduler">第三步, 启动scheduler</h4>
<div class="hlcode"><pre><span class="n">airflow</span> <span class="n">scheduler</span>
</pre></div>


<p>scheduler启动后, DAG目录下的dags就会根据设定的时间定时启动</p>
<p>此外,我们还可以直接测试单个的DAG.</p>
<h1 id="mysql">连接宿主机的mysql</h1>
<p>本文使用的是windows下面的docker,宿主机是windows系统,docker是ubunu系统.</p>
<h3 id="mysql_1">宿主机安装mysql</h3>
<p>首先,确保宿主机上已经安装好mysql,并且已经启动.</p>
<h3 id="airflow">airflow配置</h3>
<p>修改<code>~/airflow/</code>目录下面的<code>airflow.cfg</code><br />
将下面的对应修改成</p>
<div class="hlcode"><pre><span class="n">sql_alchemy_conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">:</span><span class="c1">//root:123456@192.168.79.1:3306/airflowdb</span>
</pre></div>


<p>配置完成之后运行<code>airflow initdb</code>, 这时候会出现下面的错误,airflow官网有提示<a href="Exception: Global variable explicit_defaults_for_timestamp needs to be on (1) for mysql">Exception: Global variable explicit_defaults_for_timestamp needs to be on (1) for mysql<br />
</a>.</p>
<p>所以需要我们修改mysql的配置文件.</p>
<h5 id="windows">windows下面</h5>
<p>windows下使用源码安装的mysql, 需要在文件目录下面新建一个<code>my.ini</code>文件,注意文件名不能弄错,不然启动不了mysql.在<code>my.ini</code>文件中添加<code>explicit_defaults_for_timestamp = 1</code>,然后重启mysql即可.</p>
<h4 id="ubuntu">ubuntu下</h4>
<p>使用<code>whereis mysql</code>找到mysql的路径,如<code>/etc/mysql/</code>, 修改mysql目录下的<code>my.cnf</code>, 同样在文件中添加<code>explicit_defaults_for_timestamp = 1</code>然后重启mysql服务即可,</p>
<p>配置完mysql重新执行<code>airflow init</code>,则会看到下面的内容.</p>
<div class="hlcode"><pre><span class="n">airflow</span> <span class="n">initdb</span>
</pre></div>


<div class="hlcode"><pre><span class="p">(</span><span class="n">venv33</span><span class="p">)</span> <span class="n">jerry</span><span class="err">@</span><span class="mi">8</span><span class="n">a005187af9b</span><span class="o">:~/</span><span class="n">airflow</span><span class="err">$</span> <span class="n">airflow</span> <span class="n">initdb</span>
<span class="p">[</span><span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">22</span> <span class="mo">02</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="mi">084</span><span class="p">]</span> <span class="p">{</span><span class="n">settings</span><span class="p">.</span><span class="n">py</span><span class="o">:</span><span class="mi">174</span><span class="p">}</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">settings</span><span class="p">.</span><span class="n">configure_orm</span><span class="p">()</span><span class="o">:</span> <span class="n">Using</span> <span class="n">pool</span> <span class="n">settings</span><span class="p">.</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pool_recycle</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="mi">234</span>
<span class="p">[</span><span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">22</span> <span class="mo">02</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="mi">348</span><span class="p">]</span> <span class="p">{</span><span class="n">__init__</span><span class="p">.</span><span class="n">py</span><span class="o">:</span><span class="mi">51</span><span class="p">}</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Using</span> <span class="n">executor</span> <span class="n">LocalExecutor</span>
<span class="nl">DB:</span> <span class="n">mysql</span><span class="o">:</span><span class="c1">//root:***@192.168.79.1:3306/airflowdb</span>
<span class="p">[</span><span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">22</span> <span class="mo">02</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="mi">581</span><span class="p">]</span> <span class="p">{</span><span class="n">db</span><span class="p">.</span><span class="n">py</span><span class="o">:</span><span class="mi">338</span><span class="p">}</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Creating</span> <span class="n">tables</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Context</span> <span class="n">impl</span> <span class="n">MySQLImpl</span><span class="p">.</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Will</span> <span class="n">assume</span> <span class="n">non</span><span class="o">-</span><span class="n">transactional</span> <span class="n">DDL</span><span class="p">.</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="n">d2ae31099d61</span> <span class="o">-&gt;</span> <span class="mf">0e2</span><span class="n">a74e0fc9f</span><span class="p">,</span> <span class="n">Add</span> <span class="n">time</span> <span class="n">zone</span> <span class="n">awareness</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="n">d2ae31099d61</span> <span class="o">-&gt;</span> <span class="mi">33</span><span class="n">ae817a1ff4</span><span class="p">,</span> <span class="n">kubernetes_resource_checkpointing</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">33</span><span class="n">ae817a1ff4</span> <span class="o">-&gt;</span> <span class="mi">27</span><span class="n">c6a30d7c24</span><span class="p">,</span> <span class="n">kubernetes_resource_checkpointing</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">27</span><span class="n">c6a30d7c24</span> <span class="o">-&gt;</span> <span class="mi">86770</span><span class="n">d1215c0</span><span class="p">,</span> <span class="n">add</span> <span class="n">kubernetes</span> <span class="n">scheduler</span> <span class="n">uniqueness</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">86770</span><span class="n">d1215c0</span><span class="p">,</span> <span class="mf">0e2</span><span class="n">a74e0fc9f</span> <span class="o">-&gt;</span> <span class="mf">05f</span><span class="mi">30312</span><span class="n">d566</span><span class="p">,</span> <span class="n">merge</span> <span class="n">heads</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mf">05f</span><span class="mi">30312</span><span class="n">d566</span> <span class="o">-&gt;</span> <span class="n">f23433877c24</span><span class="p">,</span> <span class="n">fix</span> <span class="n">mysql</span> <span class="n">not</span> <span class="n">null</span> <span class="n">constraint</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="n">f23433877c24</span> <span class="o">-&gt;</span> <span class="mi">856955</span><span class="n">da8476</span><span class="p">,</span> <span class="n">fix</span> <span class="n">sqlite</span> <span class="n">foreign</span> <span class="n">key</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">856955</span><span class="n">da8476</span> <span class="o">-&gt;</span> <span class="mi">9635</span><span class="n">ae0956e7</span><span class="p">,</span> <span class="n">index</span><span class="o">-</span><span class="n">faskfail</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">9635</span><span class="n">ae0956e7</span> <span class="o">-&gt;</span> <span class="n">dd25f486b8ea</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="n">dd25f486b8ea</span> <span class="o">-&gt;</span> <span class="n">bf00311e1990</span><span class="p">,</span> <span class="n">add</span> <span class="n">index</span> <span class="n">to</span> <span class="n">taskinstance</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">9635</span><span class="n">ae0956e7</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="n">a2a5b66e19d</span><span class="p">,</span> <span class="n">add</span> <span class="n">task_reschedule</span> <span class="n">table</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mi">0</span><span class="n">a2a5b66e19d</span><span class="p">,</span> <span class="n">bf00311e1990</span> <span class="o">-&gt;</span> <span class="mo">03</span><span class="n">bc53e68815</span><span class="p">,</span> <span class="n">merge_heads_2</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">alembic</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">migration</span><span class="p">]</span> <span class="n">Running</span> <span class="n">upgrade</span> <span class="mo">03</span><span class="n">bc53e68815</span> <span class="o">-&gt;</span> <span class="mf">41f5f12752f</span><span class="mi">8</span><span class="p">,</span> <span class="n">add</span> <span class="n">superuser</span> <span class="n">field</span>
<span class="n">WARNI</span> <span class="p">[</span><span class="n">airflow</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="n">logging_mixin</span><span class="p">.</span><span class="n">LoggingMixin</span><span class="p">]</span> <span class="n">empty</span> <span class="n">cryptography</span> <span class="n">key</span> <span class="o">-</span> <span class="n">values</span> <span class="n">will</span> <span class="n">not</span> <span class="n">be</span> <span class="n">stored</span> <span class="n">encrypted</span><span class="p">.</span>
<span class="n">Done</span><span class="p">.</span>
</pre></div>


<h1 id="_4">附录</h1>
<h2 id="explicit_defaults_for_timestamp">explicit_defaults_for_timestamp 错误</h2>
<div class="hlcode"><pre><span class="cp">[</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">22</span> <span class="mi">02</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="mi">604</span><span class="cp">]</span> {settings.py:174} INFO - settings.configure_orm(): Using pool settings. pool_size=5, pool_recycle=1800, pid=229
<span class="cp">[</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">22</span> <span class="mi">02</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="mi">865</span><span class="cp">]</span> {__init__.py:51} INFO - Using executor LocalExecutor
DB: mysql://root:***@192.168.79.1:3306/airflowdb
<span class="cp">[</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">22</span> <span class="mi">02</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span><span class="mi">098</span><span class="cp">]</span> {db.py:338} INFO - Creating tables
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Context impl MySQLImpl.
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Will assume non-transactional DDL.
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade  -&gt; e3a246e0dc1, current schema
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade e3a246e0dc1 -&gt; 1507a7289a2f, create is_encrypted
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 1507a7289a2f -&gt; 13eb55f81627, maintain history for compatibility with earlier migrations
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 13eb55f81627 -&gt; 338e90f54d61, More logging into task_instance
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 338e90f54d61 -&gt; 52d714495f0, job_id indices
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 52d714495f0 -&gt; 502898887f84, Adding extra to Log
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 502898887f84 -&gt; 1b38cef5b76e, add dagrun
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 1b38cef5b76e -&gt; 2e541a1dcfed, task_duration
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 2e541a1dcfed -&gt; 40e67319e3a9, dagrun_config
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 40e67319e3a9 -&gt; 561833c1c74b, add password column to user
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 561833c1c74b -&gt; 4446e08588, dagrun start end
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 4446e08588 -&gt; bbc73705a13e, Add notification_sent column to sla_miss
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade bbc73705a13e -&gt; bba5a7cfc896, Add a column to track the encryption state of the &#39;Extra&#39; field in connection
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade bba5a7cfc896 -&gt; 1968acfc09e3, add is_encrypted column to variable table
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 1968acfc09e3 -&gt; 2e82aab8ef20, rename user table
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 2e82aab8ef20 -&gt; 211e584da130, add TI state index
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 211e584da130 -&gt; 64de9cddf6c9, add task fails journal table
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 64de9cddf6c9 -&gt; f2ca10b85618, add dag_stats table
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade f2ca10b85618 -&gt; 4addfa1236f1, Add fractional seconds to mysql tables
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 4addfa1236f1 -&gt; 8504051e801b, xcom dag task indices
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 8504051e801b -&gt; 5e7d17757c7a, add pid field to TaskInstance
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 5e7d17757c7a -&gt; 127d2bf2dfa7, Add dag_id/state index on dag_run table
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 127d2bf2dfa7 -&gt; cc1e65623dc7, add max tries column to task instance
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade cc1e65623dc7 -&gt; bdaa763e6c56, Make xcom value column a large binary
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade bdaa763e6c56 -&gt; 947454bf1dff, add ti job_id index
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade 947454bf1dff -&gt; d2ae31099d61, Increase text size for MySQL (not relevant for other DBs&#39; text types)
INFO  <span class="cp">[</span><span class="nx">alembic.runtime.migration</span><span class="cp">]</span> Running upgrade d2ae31099d61 -&gt; 0e2a74e0fc9f, Add time zone awareness
Traceback (most recent call last):
  File &quot;/home/jerry/workshop/venv/venv33/bin/airflow&quot;, line 32, in <span class="nt">&lt;module&gt;</span>
    args.func(args)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/bin/cli.py&quot;, line 1074, in initdb
    db.initdb(settings.RBAC)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/utils/db.py&quot;, line 91, in initdb
    upgradedb()
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/utils/db.py&quot;, line 346, in upgradedb
    command.upgrade(config, &#39;heads&#39;)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/command.py&quot;, line 174, in upgrade
    script.run_env()
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/script/base.py&quot;, line 416, in run_env
    util.load_python_file(self.dir, &#39;env.py&#39;)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/util/pyfiles.py&quot;, line 93, in load_python_file
    module = load_module_py(module_id, path)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/util/compat.py&quot;, line 68, in load_module_py
    module_id, path).load_module(module_id)
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap_external</span><span class="nt">&gt;</span>&quot;, line 399, in _check_name_wrapper
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap_external</span><span class="nt">&gt;</span>&quot;, line 823, in load_module
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap_external</span><span class="nt">&gt;</span>&quot;, line 682, in load_module
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap</span><span class="nt">&gt;</span>&quot;, line 265, in _load_module_shim
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap</span><span class="nt">&gt;</span>&quot;, line 684, in _load
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap</span><span class="nt">&gt;</span>&quot;, line 665, in _load_unlocked
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap_external</span><span class="nt">&gt;</span>&quot;, line 678, in exec_module
  File &quot;<span class="nt">&lt;frozen</span> <span class="na">importlib</span><span class="err">.</span><span class="na">_bootstrap</span><span class="nt">&gt;</span>&quot;, line 219, in _call_with_frames_removed
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/migrations/env.py&quot;, line 92, in <span class="nt">&lt;module&gt;</span>
    run_migrations_online()
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/migrations/env.py&quot;, line 86, in run_migrations_online
    context.run_migrations()
  File &quot;<span class="nt">&lt;string&gt;</span>&quot;, line 8, in run_migrations
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/runtime/environment.py&quot;, line 807, in run_migrations
    self.get_context().run_migrations(**kw)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/alembic/runtime/migration.py&quot;, line 321, in run_migrations
    step.migration_fn(**kw)
  File &quot;/home/jerry/workshop/venv/venv33/lib/python3.6/site-packages/airflow/migrations/versions/0e2a74e0fc9f_add_time_zone_awareness.py&quot;, line 46, in upgrade
    raise Exception(&quot;Global variable explicit_defaults_for_timestamp needs to be on (1) for mysql&quot;)
Exception: Global variable explicit_defaults_for_timestamp needs to be on (1) for mysql
</pre></div>


<h1 id="_5">参考文献</h1>
<p><a href="https://blog.csdn.net/haofangasd/article/details/83045432">airflow分布式部署、参数配置、优劣势分析、工程经验</a></p>
<p><a href="https://blog.csdn.net/wendingzhulu/article/details/53417328">Docker尝鲜之Airflow快速安装</a></p>
<p><a href="http://blog.genesino.com/2016/05/airflow/">Airflow usage</a></p>
<p><a href="https://blog.csdn.net/qq_29719097/article/details/83577021">explicit_defaults_for_timestamp</a></p>
</div>
<div id="content-footer">created in <span class="create-date date"> 2019-03-22 00:00 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  title: 'airflow安装与使用',
  owner: 'sthsf',
  repo: 'wiki',
  oauth: {
    client_id: '086c54c5fd95adfdc372',
    client_secret: '2ad9ebe87b952d2c77fccf99c334881b91eaa73d',
  },
  // ...
  // For more available options, check out the documentation below
})
gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

</div>
<div id="footer">
            <span>
                Copyright © 2022 LiYu.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/sthsf/wiki" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?90e1dcdd1938573c19f9ff6521188e91";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>