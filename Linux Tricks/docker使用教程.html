<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>docker使用教程 - LiYu's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Economics"/>
    <meta name="description" content="A wiki website of sthsf when I learned new knowledgy and technics."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Linux Tricks">Linux Tricks</a>&nbsp;»&nbsp;docker使用教程</div>
</div>
<div class="clearfix"></div>
<div id="title">docker使用教程</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">写在前面</a></li>
<li><a href="#_2">符号约定</a></li>
<li><a href="#docker">启动和关闭docker服务</a></li>
<li><a href="#_3">基本操作</a><ul>
<li><a href="#docker_1">搜索docker镜像</a></li>
<li><a href="#_4">拉取或者下载镜像</a></li>
</ul>
</li>
<li><a href="#imagecontainer">运行image实例container</a></li>
<li><a href="#imagecontainer_1">启动和停止某个image的container</a></li>
<li><a href="#docker_2">Docker常用命令</a><ul>
<li><a href="#dockervim-telnetifconfig">Docker下安装vim 、telnet、ifconfig命令</a></li>
<li><a href="#docker-commitdocker-push">通过容器提交镜像（docker commit）以及推送镜像（docker push)</a></li>
</ul>
</li>
<li><a href="#docker_3">docker端口映射</a><ul>
<li><a href="#_5">创建容器时指定映射的端口</a><ul>
<li><a href="#_6">宿主机添加端口放行</a></li>
<li><a href="#docker_4">docker 多端口映射多卷映射</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker_5">Docker 文件传输系统</a><ul>
<li><a href="#docker_6">Docker 挂载本地目录</a></li>
<li><a href="#docker_7">Docker 和宿主机中相互传递文件</a><ul>
<li><a href="#dockercontainer">根据docker中的container的名字传送</a></li>
<li><a href="#scp">通过scp传送</a></li>
</ul>
</li>
<li><a href="#dockerssh">Docker开启ssh服务</a><ul>
<li><a href="#rootopenssh">修改root密码,安装openssh服务</a></li>
<li><a href="#_7">修改配置文件</a></li>
<li><a href="#ssh">启动ssh服务</a></li>
<li><a href="#_8">登录测试</a></li>
</ul>
</li>
<li><a href="#docker_8">Docker镜像跨服务器迁移</a><ul>
<li><a href="#1save">1、save</a></li>
<li><a href="#2export">2、export</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker_9">docker 添加用户</a></li>
<li><a href="#docker_10">docker 三剑客</a><ul>
<li><a href="#docker-machine">docker machine</a></li>
<li><a href="#docker-swarm">docker swarm</a></li>
<li><a href="#docker-compose">docker compose</a></li>
</ul>
</li>
<li><a href="#centosdocker">centos下安装docker</a><ul>
<li><a href="#docker-ce">安装docker-ce</a><ul>
<li><a href="#1">方法 1</a></li>
<li><a href="#2">方法2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#centosnvidia-docker2">centos下安装nvidia-docker2</a></li>
<li><a href="#_9">参考文献</a></li>
</ul>
</div>
<h1 id="_1">写在前面</h1>
<p>linux的使用过程中经常需要涉及到编译，运行等过程。最麻烦的就是在不同的机器上重复相同的劳动，docker的存在让一切变得简单很多，下面介绍docker的一些基本知识和操作。</p>
<h1 id="_2">符号约定</h1>
<ul>
<li>
<p>&lt; xxx &gt;自定义内容</p>
</li>
<li>
<p>[ xxx ] 可选内容</p>
</li>
<li>
<p>[&lt; xxx &gt;] 自定义可选内容</p>
</li>
</ul>
<h1 id="docker">启动和关闭docker服务</h1>
<ul>
<li>启动</li>
</ul>
<div class="hlcode"><pre><span class="n">service</span> <span class="n">docker</span> <span class="n">start</span>
<span class="err">或</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">docker</span>
</pre></div>


<ul>
<li>关闭</li>
</ul>
<div class="hlcode"><pre><span class="n">service</span> <span class="n">docker</span> <span class="n">stop</span>
<span class="err">或</span>
<span class="n">systemctl</span> <span class="n">stop</span> <span class="n">docker</span>
</pre></div>


<h1 id="_3">基本操作</h1>
<h4 id="docker_1">搜索docker镜像</h4>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">search</span> <span class="p">[</span><span class="err">镜像名</span><span class="p">]</span>
</pre></div>


<h4 id="_4">拉取或者下载镜像</h4>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">pull</span> <span class="p">[</span><span class="n">NAME</span><span class="p">]</span>
</pre></div>


<h1 id="imagecontainer">运行image实例container</h1>
<p>对于Docker来说，image是静态的，类似于操作系统快照，而container则是动态的，是image的运行实例。<br />
先使用<code>sudo docker images</code>查看pull下来的iamge。<br />
如：</p>
<div class="hlcode"><pre><span class="n">REPOSITORY</span>           <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">SIZE</span>
<span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span>   <span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span>    <span class="n">e8667aaa087d</span>        <span class="mi">5</span> <span class="n">days</span> <span class="n">ago</span>          <span class="mf">4.34</span><span class="n">GB</span>
</pre></div>


<p>则可以通过下面两种方式创建一个守护态的Docker容器</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="p">[</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span><span class="p">]</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="err">或</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="p">[</span><span class="n">e8667aaa087d</span><span class="p">]</span>
</pre></div>


<p>具体参数可以网上搜索</p>
<p>这样就可以进入container了</p>
<div class="hlcode"><pre><span class="n">root</span><span class="err">@</span><span class="n">f906aeaa80e7</span><span class="o">:</span>
</pre></div>


<p>同时。我们可以在container所在的外部操作系统中运行<code>sudo docker ps</code>和<code>sudo docker ps -a</code>来分别查看运行中的container id和所有的包括未运行的container id。</p>
<div class="hlcode"><pre><span class="n">CONTAINER</span> <span class="n">ID</span>        <span class="n">IMAGE</span>                                 <span class="n">COMMAND</span>             <span class="n">CREATED</span>             <span class="n">STATUS</span>                   <span class="n">PORTS</span>                    <span class="n">NAMES</span>
<span class="mi">1</span><span class="n">a2b5c8e0f69</span>        <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span>   <span class="s">&quot;/bin/bash&quot;</span>         <span class="mi">9</span> <span class="n">hours</span> <span class="n">ago</span>         <span class="n">Exited</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="mi">9</span> <span class="n">hours</span> <span class="n">ago</span>                            <span class="n">hardcore_rosalind</span>
<span class="n">c820900be758</span>        <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span>   <span class="s">&quot;/bin/bash&quot;</span>         <span class="mi">20</span> <span class="n">hours</span> <span class="n">ago</span>        <span class="n">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">2</span> <span class="n">hours</span> <span class="n">ago</span>                            <span class="n">brave_agnesi</span>
<span class="n">aad1b70763ab</span>        <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span>   <span class="s">&quot;/bin/bash&quot;</span>         <span class="mi">20</span> <span class="n">hours</span> <span class="n">ago</span>        <span class="n">Created</span>                                           <span class="n">condescending_jackson</span>
<span class="n">f906aeaa80e7</span>        <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gpu</span>   <span class="s">&quot;/bin/bash&quot;</span>         <span class="mi">20</span> <span class="n">hours</span> <span class="n">ago</span>        <span class="n">Up</span> <span class="mi">2</span> <span class="n">hours</span>               <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">8500</span><span class="o">-&gt;</span><span class="mi">8500</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">mystifying_sinoussi</span>
</pre></div>


<h1 id="imagecontainer_1">启动和停止某个image的container</h1>
<p>对于docker还是小白的我遇到这样一个问题，我pull了一个image到本地，然后运行这个image，这时候系统会生成一个contaner ID，我在contaner中安装了很多东西，比如vim，pip 之类的简单应用，并且编译了一些程序。完成之后直接退出。第二天使用的时候我还是运行了这个image，但是之前所有的配置全部没了。后来发现是自己错了，我每次运行的都是第一次pull下来的image，相当于每次启动的都是一个新的container，而我原来配置编译的那个container需要使用<code>sudo docker ps -a</code>就能看出来了。</p>
<ul>
<li><strong>启动某个container</strong></li>
</ul>
<p>如果想要再次打开之前使用过的container，则可以运行：</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">start</span> <span class="p">[</span><span class="n">container_name</span><span class="p">]</span>
<span class="err">或</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">start</span> <span class="p">[</span><span class="n">CONTAINER_ID</span><span class="p">]</span>
</pre></div>


<ul>
<li><strong>重启某个container</strong></li>
</ul>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">restart</span> <span class="p">[</span><span class="n">container_name</span><span class="p">]</span>
<span class="err">或</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">restart</span> <span class="p">[</span><span class="n">CONTAINER_ID</span><span class="p">]</span>
</pre></div>


<p>启动该container之后，使用<code>sudo docker attach container_name/container_id</code>进入该container。</p>
<ul>
<li><strong>进入Docker Container</strong><br />
1、Docker提供了attach命令来进入Docker容器(不建议)</li>
</ul>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">attach</span> <span class="p">[</span><span class="n">CONTAINER_ID</span><span class="p">]</span>
</pre></div>


<p>2、使用ssh进入Docker容器(不建议使用)</p>
<p>3、使用nsenter进入Docker容器(建议)<br />
<a href="https://github.com/jpetazzo/nsenter">Looking to start a shell inside a Docker container?</a></p>
<p>4、使用docker exec 进入Docker容器<br />
使用docker提供的新的命令exec进入容器</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">ps</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="p">[</span><span class="n">CONTAINER_ID</span><span class="p">]</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>


<ul>
<li><strong>退出某个Container</strong></li>
</ul>
<div class="hlcode"><pre><span class="err">直接使用</span><span class="n">Ctrl</span> <span class="o">+</span><span class="n">d</span> <span class="err">或者在</span><span class="n">container</span><span class="err">中运行</span><span class="n">exit</span>
</pre></div>


<p>如果想退出某个docker但是又不想停止docker运行,则可以使用<code>Ctrl + p + q</code>即可.</p>
<h1 id="docker_2">Docker常用命令</h1>
<p>docker的常用命令</p>
<div class="hlcode"><pre><span class="cp"># 创建Docker镜像</span>
<span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">fensme</span><span class="o">:</span><span class="n">v1</span>

<span class="cp"># 运行镜像</span>
<span class="n">docker</span> <span class="n">run</span> <span class="n">fensme</span>

<span class="cp"># 运行镜像并进入</span>
<span class="n">docker</span> <span class="n">run</span>  <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">fensme</span>  <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>

<span class="cp"># 登录镜像平台</span>
<span class="n">docker</span> <span class="n">login</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">bsspirit</span> <span class="o">--</span><span class="n">email</span><span class="o">=</span><span class="n">bsspirit</span><span class="err">@</span><span class="mf">163.</span><span class="n">com</span>

<span class="cp"># 增加镜像空间名</span>
<span class="n">docker</span> <span class="n">tag</span> <span class="mi">8496</span><span class="n">b10e857a</span> <span class="n">bsspirit</span><span class="o">/</span><span class="n">fensme</span><span class="o">:</span><span class="n">latest</span>

<span class="cp"># 提交镜像</span>
<span class="n">docker</span> <span class="n">push</span> <span class="n">bsspirit</span><span class="o">/</span><span class="n">fensme</span>

<span class="cp"># 删除镜像</span>
<span class="n">docker</span> <span class="n">rmi</span> <span class="o">&lt;</span><span class="n">image</span> <span class="n">id</span><span class="o">&gt;</span>

<span class="cp"># 删除所有镜像</span>
<span class="n">docker</span> <span class="n">rmi</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">images</span>  <span class="o">-</span><span class="n">q</span><span class="p">)</span>

<span class="cp"># 进入镜像修改后，保存产生新镜像</span>
<span class="n">docker</span> <span class="n">commit</span> <span class="err">$</span><span class="p">(</span><span class="n">container</span> <span class="n">id</span><span class="err">前三位</span><span class="p">)</span> <span class="n">ubuntu_sshd_gerry</span><span class="o">:</span><span class="mf">14.04</span>
<span class="err">就是将修改后的</span><span class="n">continer</span><span class="err">保存为</span><span class="n">image</span><span class="p">.</span>

<span class="cp"># 停止所有的container</span>
<span class="n">docker</span>  <span class="n">stop</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span>
<span class="n">stop</span> <span class="err">后面跟</span> <span class="n">container</span> <span class="n">id</span> <span class="err">则为停止该</span><span class="n">container</span>

<span class="cp"># 删除所有的contrainer</span>
<span class="n">docker</span> <span class="n">rm</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span>

<span class="cp"># 进入正在运行的contrainer</span>
<span class="n">docker</span> <span class="n">attach</span> <span class="n">db3</span> 
<span class="n">docker</span> <span class="n">attach</span> <span class="n">d48b21a7e439</span>
<span class="n">attach</span> <span class="err">后面可以为</span><span class="n">container</span> <span class="n">id</span> <span class="err">也可以是</span><span class="n">container</span> <span class="n">name</span>

<span class="cp"># SSH启动</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">p</span> <span class="mi">10022</span><span class="o">:</span><span class="mi">22</span> <span class="n">vnpy</span><span class="o">:</span><span class="mf">1.2</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sshd</span> <span class="o">-</span><span class="n">D</span>
<span class="err">注意</span><span class="p">,</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">sshd</span><span class="err">是在</span><span class="n">linux</span><span class="err">环境下使用的</span><span class="p">,</span> <span class="n">windows</span><span class="err">环境可能不使用</span>
<span class="err">上面的命令是将宿主机的</span><span class="mi">10022</span><span class="err">端口和</span><span class="n">docker</span> <span class="n">container</span><span class="err">的</span><span class="mi">22</span><span class="err">端口做映射</span><span class="p">,</span><span class="err">并且在启动</span><span class="n">container</span><span class="err">的同时启动了</span><span class="n">ssh</span><span class="err">服务</span>

<span class="cp"># 重启容器</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">restart</span> <span class="n">ac01d678fcae</span>
<span class="n">restart</span> <span class="err">后面可以跟</span><span class="n">container</span> <span class="n">id</span> <span class="err">或者</span><span class="n">container</span> <span class="n">name</span>

<span class="cp"># docker容器运行中添加端口映射</span>
<span class="nl">https:</span><span class="c1">//my.oschina.net/u/266ΩΩΩ752/blog/541433</span>
</pre></div>


<h4 id="dockervim-telnetifconfig">Docker下安装vim 、telnet、ifconfig命令</h4>
<div class="hlcode"><pre><span class="cp"># 同步 /etc/apt/sources.list 和 /etc/apt/sources.list.d 中列出的源的索引，这样才能获取到最新的软件包。</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="cp"># 安装telnet</span>
<span class="err">​</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span>  <span class="n">telnet</span> 
<span class="cp"># 安装ifconfig</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span>  <span class="n">net</span><span class="o">-</span><span class="n">tools</span>
<span class="cp"># vim</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">vim</span>
</pre></div>


<h4 id="docker-commitdocker-push">通过容器提交镜像（docker commit）以及推送镜像（docker push)</h4>
<p><a href="https://www.cnblogs.com/kevingrace/p/9599988.html">笔记</a></p>
<h1 id="docker_3">docker端口映射</h1>
<h2 id="_5">创建容器时指定映射的端口</h2>
<div class="hlcode"><pre><span class="n">run</span> <span class="p">[</span><span class="o">-</span><span class="n">P</span><span class="p">][</span><span class="o">-</span><span class="n">p</span><span class="p">]</span>
</pre></div>


<p>-P , -publish-all=true | false, 大写的P表示为容器暴露的所有的端口进行映射;</p>
<p>-p, -publish=[], 小写的p表示为容器指定的端口进行映射, 有四种形式:</p>
<ul>
<li>
<p>containerPort: 只指定容器的端口, 宿主机端口随机映射;</p>
</li>
<li>
<p>hostPort:containerPort: 同时指定容器与宿主机端口一一映射;</p>
</li>
<li>
<p>ip::containerPort: 指定ip和容器的端口;</p>
</li>
<li>
<p>ip:hostPort:containerPort: 指定ip、宿主机端口以及容器端口.</p>
</li>
</ul>
<p>例如:</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="o">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mf">0.0.0.0</span><span class="o">::</span><span class="mi">80</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">8080</span><span class="o">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">ubuntu</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>


<p>另外在容器上也是可以看到对应的端口是否被docker容器监听</p>
<div class="hlcode"><pre><span class="n">netstat</span> <span class="o">-</span><span class="n">tunlp</span>
<span class="n">Proto</span> <span class="n">Recv</span><span class="o">-</span><span class="n">Q</span> <span class="n">Send</span><span class="o">-</span><span class="n">Q</span> <span class="n">Local</span> <span class="n">Address</span>           <span class="n">Foreign</span> <span class="n">Address</span>         <span class="n">State</span>       <span class="n">PID</span><span class="o">/</span><span class="n">Program</span> <span class="n">name</span>
<span class="n">tcp</span>        <span class="mi">0</span>      <span class="mi">0</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">22</span>              <span class="mf">0.0.0.0</span><span class="o">:*</span>               <span class="n">LISTEN</span>      <span class="mi">778</span><span class="o">/</span><span class="n">sshd</span>
<span class="n">tcp6</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="o">:::</span><span class="mi">22</span>                   <span class="o">:::*</span>                    <span class="n">LISTEN</span>      <span class="mi">778</span><span class="o">/</span><span class="n">sshd</span>
</pre></div>


<h3 id="_6">宿主机添加端口放行</h3>
<p>如果宿主机没有开启 ip 转发功能，会导致外部网络访问宿主机对应端口时没能转发到 Docker Container 所对应的端口上.</p>
<p>如果存在这种情况,则说明宿主机的这些端口对外是关闭的,则需要我们手动去打开.</p>
<div class="hlcode"><pre><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="p">[</span><span class="mi">8080</span><span class="p">]</span> <span class="o">-</span><span class="n">j</span> <span class="n">ACCEPT</span>
<span class="n">service</span> <span class="n">iptables</span> <span class="n">save</span>
</pre></div>


<h3 id="docker_4">docker 多端口映射多卷映射</h3>
<p>如果一个参数的选项格式是[],比如<br />
-H=[]host<br />
-p=[]portdirection<br />
这都意味着这个flag可以多次出现，所以此处可以多次指定端口映射规则。</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span><span class="o">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">22</span><span class="o">:</span><span class="mi">22</span> <span class="o">-</span><span class="n">it</span> <span class="p">[</span><span class="n">CONTAINERID</span><span class="p">]</span>
</pre></div>


<h1 id="docker_5">Docker 文件传输系统</h1>
<h2 id="docker_6">Docker 挂载本地目录</h2>
<p>docker 挂载目录跟端口映射方法类似, 都是需要在docker启动的过程中配置相应的参数.</p>
<p>挂载目录后镜像内就可以共享宿主机里面的文件<br />
通过<code>run -v</code>参数指定挂载目录(格式: 宿主机目录:镜像内挂在目录), 如果宿主机目录不存在则自动创建</p>
<div class="hlcode"><pre><span class="o">-</span><span class="n">v</span> <span class="p">{</span><span class="err">宿主机路径</span><span class="p">}</span><span class="o">:</span><span class="p">{</span><span class="n">docker</span> <span class="n">container</span><span class="err">路径</span><span class="p">}</span>
</pre></div>


<p>实例:</p>
<div class="hlcode"><pre><span class="cp"># 启动一个镜像,运行一个容器, 并设置挂在目录</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="n">data</span><span class="o">:/</span><span class="n">data</span> <span class="p">[</span><span class="n">IMAGE</span> <span class="n">ID</span><span class="o">/</span> <span class="n">REPOSITORY</span><span class="p">]</span>
</pre></div>


<p>此时从宿主机上/home/ubuntu/downloads/文件夹下多出来/data目录</p>
<p>并且,在container中操作/data下面的内容时,宿主机上对应目录下也会有相应的操作.</p>
<p><strong><em>注意</em></strong><br />
如果挂载的是windows下面的文件目录, 则需要设置Docker for windows Shared Drivers, 具体设置过程可以参考<a href="https://blogs.msdn.microsoft.com/stevelasker/2016/06/14/configuring-docker-for-windows-volumes/">docker 官网</a>, 设置完成之后挂在方式不变.</p>
<p>错误提示如下:</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">10080</span><span class="o">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">10022</span><span class="o">:</span><span class="mi">22</span> <span class="o">-</span><span class="n">p</span> <span class="mi">18080</span><span class="o">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">p</span> <span class="mi">18000</span><span class="o">:</span><span class="mi">8000</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">workshop</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span><span class="n">workshop</span><span class="o">/</span><span class="n">venv</span> <span class="mi">3</span><span class="n">cd92bc30026</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="nl">docker:</span> <span class="n">Error</span> <span class="n">response</span> <span class="n">from</span> <span class="n">daemon</span><span class="o">:</span> <span class="n">Drive</span> <span class="n">has</span> <span class="n">not</span> <span class="n">been</span> <span class="n">shared</span><span class="p">.</span>
<span class="n">See</span> <span class="err">&#39;</span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">help</span><span class="err">&#39;</span><span class="p">.</span>
</pre></div>


<h2 id="docker_7">Docker 和宿主机中相互传递文件</h2>
<h3 id="dockercontainer">根据docker中的container的名字传送</h3>
<div class="hlcode"><pre><span class="err">#</span> <span class="nx">Container</span> <span class="o">-&gt;</span> <span class="err">宿主机</span>
<span class="nx">docker</span> <span class="nx">cp</span> <span class="err">[</span><span class="nx">OPTIONS</span><span class="cp">]</span> <span class="nt">&lt;CONTAINER:SRC</span><span class="na">_PATH</span><span class="nt">&gt;</span> <span class="nt">&lt;DEST</span><span class="na">_PATH</span><span class="nt">&gt;</span>

# 宿主机 -&gt; Container
docker cp <span class="cp">[</span><span class="nx">OPTIONS</span><span class="cp">]</span> <span class="nt">&lt;SRC</span><span class="na">_PATH</span><span class="nt">&gt;</span> <span class="nt">&lt;CONTAINER:DEST</span><span class="na">_PATH</span><span class="nt">&gt;</span>
</pre></div>


<p>示例<br />
将宿主机中 /File_kk目录 拷贝到Container 3000202323dcf 的/home/work目录下.</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">cp</span> <span class="n">File_kk</span> <span class="mi">3000202323</span><span class="n">dcf</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">cloude</span>
</pre></div>


<p>将Container 3000202323dcf 的/home/work/File_kk目录 拷贝到宿主机中 /work目录下</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">cp</span> <span class="mi">3000202323</span><span class="n">dcf</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">cloude</span><span class="o">/</span><span class="n">File_kk</span> <span class="o">/</span><span class="n">work</span>
</pre></div>


<h3 id="scp">通过scp传送</h3>
<p>如果Container开启ssh服务,则可以通过指定的ssh端口向Container中传送文件,开启ssh服务就可以类似服务器之间传送文件一样.</p>
<div class="hlcode"><pre><span class="nx">scp</span> <span class="na">-P</span> <span class="o">&lt;</span><span class="nb">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">SRC_PATH</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">USER_NAME</span><span class="o">&gt;</span><span class="p">@</span><span class="o">&lt;</span><span class="nx">IP</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="nx">DEST_PATH</span><span class="o">&gt;</span>

<span class="err">#</span> <span class="err">注</span><span class="p">,</span><span class="err">传输文件和文件目录参照</span><span class="nx">scp</span><span class="err">规则</span>
</pre></div>


<p>示例<br />
假设Container开启了ssh服务,并且与宿主机的端口映射为10022, 现在将jerry.zip复制到Container的/home/jerry/workshop/work</p>
<div class="hlcode"><pre><span class="n">scp</span> <span class="o">-</span><span class="n">P</span> <span class="mi">10022</span> <span class="n">jerry</span><span class="p">.</span><span class="n">zip</span> <span class="n">jerry</span><span class="err">@</span><span class="mf">192.168.79.1</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span><span class="n">workshop</span><span class="o">/</span><span class="n">work</span>
</pre></div>


<h2 id="dockerssh">Docker开启ssh服务</h2>
<h3 id="rootopenssh">修改root密码,安装openssh服务</h3>
<div class="hlcode"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">vim</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">net</span><span class="o">-</span><span class="n">tools</span>
</pre></div>


<h3 id="_7">修改配置文件</h3>
<p>安装成功之后,修改容器的配置文件,使得可以直接使用root登陆</p>
<div class="hlcode"><pre><span class="n">vim</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
</pre></div>


<ul>
<li>在配置文件中找到<code>#PermitRootLogin prohibit-password</code>,修改成<code>PermitRootLogin yes</code></li>
<li>将<code>UsePAM yes</code>, 修改成<code>UsePAM no</code></li>
</ul>
<div class="hlcode"><pre><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span> 
<span class="n">PermitRootLogin</span> <span class="n">yes</span>  <span class="err">#允许</span><span class="n">root</span><span class="err">用户</span><span class="n">ssh</span><span class="err">登录</span>
<span class="n">UsePAM</span> <span class="n">no</span>            <span class="err">##禁用</span><span class="n">PAM</span>
</pre></div>


<p><strong>注, 如果容器内配置文件不修改,容器可能会拒绝访问,卡在lastlogin提示, 同时还要保证宿主机开启了需要监听的端口</strong></p>
<h3 id="ssh">启动ssh服务</h3>
<div class="hlcode"><pre><span class="n">service</span> <span class="n">ssh</span> <span class="n">start</span>
</pre></div>


<p>我们也可以在启动docker的时候同时启动ssh</p>
<div class="hlcode"><pre><span class="nx">docker</span> <span class="nb">run</span> <span class="na">-d</span> <span class="na">-it</span> <span class="na">-p</span> <span class="mi">10022</span><span class="p">:</span><span class="mi">22</span> <span class="o">&lt;</span><span class="nx">IMAGE_NAME</span><span class="o">&gt;</span> <span class="p">/</span><span class="nx">usr</span><span class="p">/</span><span class="nx">sbin</span><span class="p">/</span><span class="nx">sshd</span> <span class="na">-D</span>
</pre></div>


<h3 id="_8">登录测试</h3>
<p>在宿主机或者其他机器上输入对应的username和ip地址,测试是否可以连接</p>
<div class="hlcode"><pre><span class="nx">ssh</span> <span class="na">-p</span> <span class="mi">10022</span> <span class="o">&lt;</span><span class="nx">username</span><span class="o">&gt;</span><span class="p">@</span><span class="o">&lt;</span><span class="nx">ip</span><span class="o">&gt;</span>
</pre></div>


<h2 id="docker_8">Docker镜像跨服务器迁移</h2>
<p>Docker的备份方式有export和save两种。</p>
<h3 id="1save">1、save</h3>
<p>1)、镜像保存</p>
<p>登陆到已经部署好镜像的服务器上面，执行以下命令进行导出</p>
<div class="hlcode"><pre><span class="nx">docker</span> <span class="nb">save</span> <span class="o">&lt;</span><span class="nx">IMAGE_ID</span><span class="err">前三位</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">IMAGE_NAME</span><span class="o">&gt;</span><span class="bp">.</span><span class="nx">tar</span>
</pre></div>


<p>or</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">save</span> <span class="o">-</span><span class="n">o</span> <span class="p">.</span><span class="o">/&lt;</span><span class="kt">FILE</span> <span class="n">NAME</span><span class="o">&gt;</span><span class="p">.</span><span class="n">tar</span> <span class="o">&lt;</span><span class="n">EPOSITORY</span><span class="o">:</span><span class="n">TAG</span><span class="o">&gt;</span>
</pre></div>


<p>2)、镜像导入</p>
<p>将刚才导出的镜像上传到你要导入的那台服务器上(使用scp), 执行以下命令镜像导入</p>
<div class="hlcode"><pre><span class="nx">docker</span> <span class="nx">load</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="nx">IMAGE_NAME</span><span class="o">&gt;</span><span class="bp">.</span><span class="nx">tar</span>
</pre></div>


<p>使用<code>docker images</code>查看你会发现load的镜像的TREPOSITORY和TAG为空, 可以使用下面的命令</p>
<div class="hlcode"><pre><span class="nx">docker</span> <span class="kt">tag</span> <span class="o">&lt;</span><span class="nx">IMAGE_ID</span><span class="err">前三位</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">REPOSITORY</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="kt">TAG</span><span class="o">&gt;</span>
</pre></div>


<p>对新load的image重新命名</p>
<h3 id="2export">2、export</h3>
<p>1) 导出容器</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">a</span>
<span class="n">docker</span> <span class="n">export</span> <span class="o">&lt;</span><span class="n">CONTAINER</span> <span class="n">ID</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&lt;</span><span class="kt">FILE</span> <span class="n">NMAE</span><span class="o">&gt;</span><span class="p">.</span><span class="n">tar</span>
</pre></div>


<p>2) 导入到指定的服务器</p>
<p>同样需要将刚才的导出的容器备份上传到目标服务器上，执行下面的命令</p>
<div class="hlcode"><pre><span class="nx">cat</span> <span class="o">&lt;</span><span class="nb">FILE</span> <span class="nx">NMAE</span><span class="o">&gt;</span><span class="bp">.</span><span class="nx">tar</span> <span class="o">|</span><span class="nx">docker</span> <span class="k">import</span> <span class="o">-</span> <span class="o">&lt;</span><span class="nx">REPOSITORY</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="kt">TAG</span><span class="o">&gt;</span>
</pre></div>


<p><strong><em>注意：运行导入的镜像的时候必须带command(/bin/bash)，否则启动报如下错误</em></strong></p>
<h1 id="docker_9">docker 添加用户</h1>
<h1 id="docker_10">docker 三剑客</h1>
<h2 id="docker-machine">docker machine</h2>
<h2 id="docker-swarm">docker swarm</h2>
<h2 id="docker-compose">docker compose</h2>
<p><a href="https://docs.docker.com/compose/gettingstarted/">Get started with Docker Compose</a></p>
<h1 id="centosdocker">centos下安装docker</h1>
<p>在使用<code>yum -y install docker</code>和```yum -y install docker-io````失败之后使用</p>
<div class="hlcode"><pre><span class="n">yum</span> <span class="n">install</span> <span class="n">https</span><span class="o">:</span><span class="c1">//get.docker.com/rpm/1.7.1/centos-6/RPMS/x86_64/docker-engine-1.7.1-1.el6.x86_64.rpm</span>
</pre></div>


<p>安装成功, <code>service docker start</code>启动dokcer即可.</p>
<h3 id="docker-ce">安装docker-ce</h3>
<h4 id="1">方法 1</h4>
<p>安装最新版<br />
// 1. 安装必要的一些系统工具<br />
sudo yum install -y yum-utils device-mapper-persistent-data lvm2</p>
<p>// 2. 添加软件源信息<br />
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</p>
<p>// 3. 更新并安装 Docker-CE<br />
sudo yum makecache fast<br />
sudo yum -y install docker-ce<br />
出现的问题,截图</p>
<div class="hlcode"><pre><span class="n">Public</span> <span class="n">key</span> <span class="k">for</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">18.09.7</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="p">.</span><span class="n">rpm</span> <span class="n">is</span> <span class="n">not</span> <span class="n">installed</span>
<span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">18.09.7</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="p">.</span><span class="n">rpm</span>                                                       <span class="o">|</span>  <span class="mi">14</span> <span class="n">MB</span>  <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">09</span>
<span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="mf">18.09.7</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="p">.</span><span class="n">rpm</span>                                                           <span class="o">|</span>  <span class="mi">19</span> <span class="n">MB</span>  <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">02</span>
<span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x8</span> <span class="n">FAILED</span>                                          <span class="o">=========</span> <span class="p">]</span> <span class="mf">1.9</span> <span class="n">kB</span><span class="o">/</span><span class="n">s</span> <span class="o">|</span>  <span class="mi">57</span> <span class="n">MB</span>  <span class="mo">00</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">17</span> <span class="n">ETA</span>
<span class="nl">https:</span><span class="c1">//mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm: [Errno 12] Timeout on https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm: (28, &#39;Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds&#39;)</span>
<span class="n">Trying</span> <span class="n">other</span> <span class="n">mirror</span><span class="p">.</span>
<span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x8</span> <span class="n">FAILED</span>
<span class="nl">https:</span><span class="c1">//mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm: [Errno 14] curl#6 - &quot;Could not resolve host: mirrors.aliyun.com; Unknown error&quot;</span>
<span class="n">Trying</span> <span class="n">other</span> <span class="n">mirror</span><span class="p">.</span>


<span class="n">Error</span> <span class="n">downloading</span> <span class="n">packages</span><span class="o">:</span>
  <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
</pre></div>


<p>网上的解决方法:<code>yum clean all</code>后使用<code>yun install docker-ce</code>, 未成功, 错误截图</p>
<div class="hlcode"><pre><span class="n">Error</span> <span class="n">downloading</span> <span class="n">packages</span><span class="o">:</span>
  <span class="mi">2</span><span class="o">:</span><span class="n">container</span><span class="o">-</span><span class="n">selinux</span><span class="o">-</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span><span class="p">.</span><span class="n">noarch</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
  <span class="mi">3</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="mf">18.09.7</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
  <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
  <span class="mi">1</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">18.09.7</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
</pre></div>


<p>// 4. 开启Docker服务(未到这一步)<br />
sudo service docker start</p>
<h4 id="2">方法2</h4>
<ul>
<li>SET UP THE REPOSITORY</li>
</ul>
<p>Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the devicemapper storage driver.</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">yum</span><span class="o">-</span><span class="n">utils</span> \
  <span class="n">device</span><span class="o">-</span><span class="n">mapper</span><span class="o">-</span><span class="n">persistent</span><span class="o">-</span><span class="n">data</span> \
  <span class="n">lvm2</span>
</pre></div>


<p>Use the following command to set up the stable repository.</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> \
    <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">repo</span> \
    <span class="nl">https:</span><span class="c1">//download.docker.com/linux/centos/docker-ce.repo</span>
</pre></div>


<p>Optional: Enable the nightly or test repositories.</p>
<p>These repositories are included in the docker.repo file above but are disabled by default. You can enable them alongside the stable repository. The following command enables the nightly repository.</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">enable</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">nightly</span>
</pre></div>


<p>To enable the test channel, run the following command:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">enable</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">test</span>
</pre></div>


<p>You can disable the nightly or test repository by running the yum-config-manager command with the --disable flag. To re-enable it, use the --enable flag. The following command disables the nightly repository.</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">disable</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">nightly</span>
</pre></div>


<p>Learn about nightly and test channels.</p>
<p>后面运行的过程中,系统提示会出现下面的提示</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">save</span> <span class="o">--</span><span class="n">setopt</span><span class="o">=</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">nightly</span><span class="p">.</span><span class="n">skip_if_unavailable</span><span class="o">=</span><span class="nb">true</span>
</pre></div>


<ul>
<li>INSTALL DOCKER CE</li>
</ul>
<p>Install the latest version of Docker CE and containerd, or go to the next step to install a specific version:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span>
</pre></div>


<p><strong><em>目前还是没有安装成功</em></strong><br />
失败截图:</p>
<div class="hlcode"><pre><span class="n">Error</span> <span class="n">downloading</span> <span class="n">packages</span><span class="o">:</span>
  <span class="mi">1</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
  <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="o">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">256</span><span class="p">]</span> <span class="n">No</span> <span class="n">more</span> <span class="n">mirrors</span> <span class="n">to</span> <span class="n">try</span><span class="p">.</span>
</pre></div>


<p>目前能找到的原因应该是网络的原因, yum安装失败的主要原因都是网络问题.</p>
<p>第二天早上来运行安装命令, 尝试了两遍之后, 运行成功</p>
<p>第一遍:</p>
<div class="hlcode"><pre>[root@localhost psdz]# sudo yum install docker-ce docker-ce-cli containerd.io
Loaded plugins: fastestmirror, langpacks
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Existing lock /var/run/yum.pid: another copy is running as pid 40267.
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory :  44 M RSS (386 MB VSZ)
    Started: Thu Jul 18 17:44:11 2019 - 00:01 ago
    State  : Sleeping, pid: 40267
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory :  44 M RSS (386 MB VSZ)
    Started: Thu Jul 18 17:44:11 2019 - 00:03 ago
    State  : Sleeping, pid: 40267
Another app is currently holding the yum lock; waiting for it to exit...
  The other application is: PackageKit
    Memory :  44 M RSS (386 MB VSZ)
    Started: Thu Jul 18 17:44:11 2019 - 00:05 ago
    State  : Sleeping, pid: 40267
Loading mirror speeds from cached hostfile
http://mirrors.163.com/centos/7/os/x86_64/repodata/repomd.xml: [Errno 14] curl#6 - &quot;Could not resolve host: mirrors.163.com; Unknown error&quot;
Trying other mirror.
https://download.docker.com/linux/centos/7/x86_64/stable/repodata/repomd.xml: [Errno 14] curl#6 - &quot;Could not resolve host:download.docker.com; Unknown error&quot;
Trying other mirror.
docker-ce-test                                                                                      | 3.5 kB  00:00:00
extras                                                                                              | 3.4 kB  00:00:00
libnvidia-container/x86_64/signature                                                                |  488 B  00:00:00
libnvidia-container/x86_64/signature                                                                | 2.0 kB  00:00:00 !!!
nvidia-container-runtime/x86_64/signature                                                           |  488 B  00:00:00
nvidia-container-runtime/x86_64/signature                                                           | 2.0 kB  00:00:00 !!!
nvidia-docker/x86_64/signature                                                                      |  488 B  00:00:00
nvidia-docker/x86_64/signature                                                                      | 2.0 kB  00:00:00 !!!
updates                                                                                             | 3.4 kB  00:00:00
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package containerd.io.x86_64 0:1.2.6-3.3.el7 will be installed
--&gt; Processing Dependency: container-selinux &gt;= 2:2.74 for package: containerd.io-1.2.6-3.3.el7.x86_64
---&gt; Package docker-ce.x86_64 3:19.03.0-2.3.rc3.el7 will be installed
---&gt; Package docker-ce-cli.x86_64 1:19.03.0-2.3.rc3.el7 will be installed
--&gt; Running transaction check
---&gt; Package container-selinux.noarch 2:2.99-1.el7_6 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

===========================================================================================================================
 Package                        Arch                Version                            Repository                     Size
===========================================================================================================================
Installing:
 containerd.io                  x86_64              1.2.6-3.3.el7                      docker-ce-stable               26 M
 docker-ce                      x86_64              3:19.03.0-2.3.rc3.el7              docker-ce-test                 24 M
 docker-ce-cli                  x86_64              1:19.03.0-2.3.rc3.el7              docker-ce-test                 39 M
Installing for dependencies:
 container-selinux              noarch              2:2.99-1.el7_6                     extras                         39 k

Transaction Summary
===========================================================================================================================
Install  3 Packages (+1 Dependent package)

Total size: 90 M
Total download size: 39 M
Installed size: 368 M
Is this ok [y/d/N]: y
Downloading packages:
No Presto metadata available for docker-ce-test
docker-ce-cli-19.03.0-2.3.rc3. FAILED                                                    ]  478 B/s |  28 MB  06:47:55 ETA
https://download.docker.com/linux/centos/7/x86_64/test/Packages/docker-ce-cli-19.03.0-2.3.rc3.el7.x86_64.rpm: [Errno 12] Timeout on https://download.docker.com/linux/centos/7/x86_64/test/Packages/docker-ce-cli-19.03.0-2.3.rc3.el7.x86_64.rpm: (28, &#39;Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds&#39;)
Trying other mirror.
warning: /var/cache/yum/x86_64/7/docker-ce-test/packages/docker-ce-cli-19.03.0-2.3.rc3.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEY
Public key for docker-ce-cli-19.03.0-2.3.rc3.el7.x86_64.rpm is not installed
docker-ce-cli-19.03.0-2.3.rc3.el7.x86_64.rpm                                                        |  39 MB  00:00:12
Retrieving key from https://download.docker.com/linux/centos/gpg


GPG key retrieval failed: [Errno 14] curl#7 - &quot;Failed to connect to 2600:9000:2016:a800:3:db06:4200:93a1: Network is unreachable&quot;
</pre></div>


<p>第二遍:</p>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="n">psdz</span><span class="p">]</span><span class="err">#</span> <span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span>
<span class="n">Loaded</span> <span class="n">plugins</span><span class="o">:</span> <span class="n">fastestmirror</span><span class="p">,</span> <span class="n">langpacks</span>
<span class="n">Repository</span> <span class="n">base</span> <span class="n">is</span> <span class="n">listed</span> <span class="n">more</span> <span class="n">than</span> <span class="n">once</span> <span class="n">in</span> <span class="n">the</span> <span class="n">configuration</span>
<span class="n">Repository</span> <span class="n">updates</span> <span class="n">is</span> <span class="n">listed</span> <span class="n">more</span> <span class="n">than</span> <span class="n">once</span> <span class="n">in</span> <span class="n">the</span> <span class="n">configuration</span>
<span class="n">Repository</span> <span class="n">extras</span> <span class="n">is</span> <span class="n">listed</span> <span class="n">more</span> <span class="n">than</span> <span class="n">once</span> <span class="n">in</span> <span class="n">the</span> <span class="n">configuration</span>
<span class="n">Repository</span> <span class="n">centosplus</span> <span class="n">is</span> <span class="n">listed</span> <span class="n">more</span> <span class="n">than</span> <span class="n">once</span> <span class="n">in</span> <span class="n">the</span> <span class="n">configuration</span>
<span class="n">Loading</span> <span class="n">mirror</span> <span class="n">speeds</span> <span class="n">from</span> <span class="n">cached</span> <span class="n">hostfile</span>
<span class="n">base</span>                                                                                                <span class="o">|</span> <span class="mf">3.6</span> <span class="n">kB</span>  <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
<span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">stable</span>                                                                                    <span class="o">|</span> <span class="mf">3.5</span> <span class="n">kB</span>  <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
<span class="n">Resolving</span> <span class="n">Dependencies</span>
<span class="o">--&gt;</span> <span class="n">Running</span> <span class="n">transaction</span> <span class="n">check</span>
<span class="o">---&gt;</span> <span class="n">Package</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">0</span><span class="o">:</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span>
<span class="o">--&gt;</span> <span class="n">Processing</span> <span class="n">Dependency</span><span class="o">:</span> <span class="n">container</span><span class="o">-</span><span class="n">selinux</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">:</span><span class="mf">2.74</span> <span class="k">for</span> <span class="n">package</span><span class="o">:</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>
<span class="o">---&gt;</span> <span class="n">Package</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">3</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span>
<span class="o">---&gt;</span> <span class="n">Package</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">1</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span>
<span class="o">--&gt;</span> <span class="n">Running</span> <span class="n">transaction</span> <span class="n">check</span>
<span class="o">---&gt;</span> <span class="n">Package</span> <span class="n">container</span><span class="o">-</span><span class="n">selinux</span><span class="p">.</span><span class="n">noarch</span> <span class="mi">2</span><span class="o">:</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span>
<span class="o">--&gt;</span> <span class="n">Finished</span> <span class="n">Dependency</span> <span class="n">Resolution</span>

<span class="n">Dependencies</span> <span class="n">Resolved</span>

<span class="o">===========================================================================================================================</span>
 <span class="n">Package</span>                        <span class="n">Arch</span>                <span class="n">Version</span>                            <span class="n">Repository</span>                     <span class="n">Size</span>
<span class="o">===========================================================================================================================</span>
<span class="nl">Installing:</span>
 <span class="n">containerd</span><span class="p">.</span><span class="n">io</span>                  <span class="n">x86_64</span>              <span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span>                      <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">stable</span>               <span class="mi">26</span> <span class="n">M</span>
 <span class="n">docker</span><span class="o">-</span><span class="n">ce</span>                      <span class="n">x86_64</span>              <span class="mi">3</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span>              <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">test</span>                 <span class="mi">24</span> <span class="n">M</span>
 <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span>                  <span class="n">x86_64</span>              <span class="mi">1</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span>              <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">test</span>                 <span class="mi">39</span> <span class="n">M</span>
<span class="n">Installing</span> <span class="k">for</span> <span class="n">dependencies</span><span class="o">:</span>
 <span class="n">container</span><span class="o">-</span><span class="n">selinux</span>              <span class="n">noarch</span>              <span class="mi">2</span><span class="o">:</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span>                     <span class="n">extras</span>                         <span class="mi">39</span> <span class="n">k</span>

<span class="n">Transaction</span> <span class="n">Summary</span>
<span class="o">===========================================================================================================================</span>
<span class="n">Install</span>  <span class="mi">3</span> <span class="n">Packages</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span> <span class="n">Dependent</span> <span class="n">package</span><span class="p">)</span>

<span class="n">Total</span> <span class="n">size</span><span class="o">:</span> <span class="mi">90</span> <span class="n">M</span>
<span class="n">Installed</span> <span class="n">size</span><span class="o">:</span> <span class="mi">368</span> <span class="n">M</span>
<span class="n">Is</span> <span class="n">this</span> <span class="n">ok</span> <span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">d</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="o">:</span> <span class="n">y</span>
<span class="n">Is</span> <span class="n">this</span> <span class="n">ok</span> <span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">d</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="o">:</span> <span class="n">y</span>
<span class="n">Downloading</span> <span class="n">packages</span><span class="o">:</span>
<span class="nl">warning:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">yum</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span><span class="p">.</span><span class="n">rpm</span><span class="o">:</span> <span class="n">Header</span> <span class="n">V4</span> <span class="n">RSA</span><span class="o">/</span><span class="n">SHA512</span> <span class="n">Signature</span><span class="p">,</span> <span class="n">key</span> <span class="n">ID</span> <span class="mf">621e9</span><span class="n">f35</span><span class="o">:</span> <span class="n">NOKEY</span>
<span class="n">Retrieving</span> <span class="n">key</span> <span class="n">from</span> <span class="n">https</span><span class="o">:</span><span class="c1">//download.docker.com/linux/centos/gpg</span>
<span class="n">Importing</span> <span class="n">GPG</span> <span class="n">key</span> <span class="mh">0x621E9F35</span><span class="o">:</span>
 <span class="n">Userid</span>     <span class="o">:</span> <span class="s">&quot;Docker Release (CE rpm) &lt;docker@docker.com&gt;&quot;</span>
 <span class="nl">Fingerprint:</span> <span class="mo">060</span><span class="n">a</span> <span class="mi">61</span><span class="n">c5</span> <span class="mi">1</span><span class="n">b55</span> <span class="mi">8</span><span class="n">a7f</span> <span class="mi">742</span><span class="n">b</span> <span class="mi">77</span><span class="n">aa</span> <span class="n">c52f</span> <span class="n">eb6b</span> <span class="mi">621</span><span class="n">e</span> <span class="mf">9f</span><span class="mi">35</span>
 <span class="n">From</span>       <span class="o">:</span> <span class="n">https</span><span class="o">:</span><span class="c1">//download.docker.com/linux/centos/gpg</span>
<span class="n">Is</span> <span class="n">this</span> <span class="n">ok</span> <span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="o">:</span> <span class="n">y</span>
<span class="n">Running</span> <span class="n">transaction</span> <span class="n">check</span>
<span class="n">Running</span> <span class="n">transaction</span> <span class="n">test</span>
<span class="n">Transaction</span> <span class="n">test</span> <span class="n">succeeded</span>
<span class="n">Running</span> <span class="n">transaction</span>
  <span class="n">Installing</span> <span class="o">:</span> <span class="mi">2</span><span class="o">:</span><span class="n">container</span><span class="o">-</span><span class="n">selinux</span><span class="o">-</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span><span class="p">.</span><span class="n">noarch</span>                                                                 <span class="mi">1</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Installing</span> <span class="o">:</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                                      <span class="mi">2</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Installing</span> <span class="o">:</span> <span class="mi">1</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                              <span class="mi">3</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Installing</span> <span class="o">:</span> <span class="mi">3</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                                  <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Verifying</span>  <span class="o">:</span> <span class="mi">1</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                              <span class="mi">1</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Verifying</span>  <span class="o">:</span> <span class="mi">3</span><span class="o">:</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                                  <span class="mi">2</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Verifying</span>  <span class="o">:</span> <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span><span class="p">.</span><span class="n">x86_64</span>                                                                      <span class="mi">3</span><span class="o">/</span><span class="mi">4</span>
  <span class="n">Verifying</span>  <span class="o">:</span> <span class="mi">2</span><span class="o">:</span><span class="n">container</span><span class="o">-</span><span class="n">selinux</span><span class="o">-</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span><span class="p">.</span><span class="n">noarch</span>                                                                 <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>

<span class="nl">Installed:</span>
  <span class="n">containerd</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">0</span><span class="o">:</span><span class="mf">1.2.6</span><span class="o">-</span><span class="mf">3.3</span><span class="p">.</span><span class="n">el7</span>  <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">3</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span>  <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="n">cli</span><span class="p">.</span><span class="n">x86_64</span> <span class="mi">1</span><span class="o">:</span><span class="mf">19.03.0</span><span class="o">-</span><span class="mf">2.3</span><span class="p">.</span><span class="n">rc3</span><span class="p">.</span><span class="n">el7</span>

<span class="n">Dependency</span> <span class="n">Installed</span><span class="o">:</span>
  <span class="n">container</span><span class="o">-</span><span class="n">selinux</span><span class="p">.</span><span class="n">noarch</span> <span class="mi">2</span><span class="o">:</span><span class="mf">2.99</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7_6</span>

<span class="n">Complete</span><span class="o">!</span>
</pre></div>


<h1 id="centosnvidia-docker2">centos下安装nvidia-docker2</h1>
<div class="hlcode"><pre><span class="cp"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span>
<span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">f</span> <span class="n">driver</span><span class="o">=</span><span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">I</span><span class="p">{}</span> <span class="o">-</span><span class="n">n1</span> <span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">f</span> <span class="n">volume</span><span class="o">=</span><span class="p">{}</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">r</span> <span class="n">docker</span> <span class="n">rm</span> <span class="o">-</span><span class="n">f</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">remove</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">docker</span>

<span class="cp"># Add the package repositories</span>
<span class="n">distribution</span><span class="o">=</span><span class="err">$</span><span class="p">(.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">os</span><span class="o">-</span><span class="n">release</span><span class="p">;</span><span class="n">echo</span> <span class="err">$</span><span class="n">ID</span><span class="err">$</span><span class="n">VERSION_ID</span><span class="p">)</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="o">:</span><span class="c1">//nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.repo | \</span>
<span class="c1">  sudo tee /etc/yum.repos.d/nvidia-docker.repo</span>

<span class="cp"># Install nvidia-docker2 and reload the Docker daemon configuration</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">docker2</span>
<span class="n">sudo</span> <span class="n">pkill</span> <span class="o">-</span><span class="n">SIGHUP</span> <span class="n">dockerd</span>
<span class="err">安装过程中</span><span class="p">,</span> <span class="err">系统会出现以下提示</span>
</pre></div>


<div class="hlcode"><pre> <span class="n">One</span> <span class="n">of</span> <span class="n">the</span> <span class="n">configured</span> <span class="n">repositories</span> <span class="n">failed</span> <span class="p">(</span><span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span><span class="p">),</span>
 <span class="n">and</span> <span class="n">yum</span> <span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="n">enough</span> <span class="n">cached</span> <span class="n">data</span> <span class="n">to</span> <span class="k">continue</span><span class="p">.</span> <span class="n">At</span> <span class="n">this</span> <span class="n">point</span> <span class="n">the</span> <span class="n">only</span>
 <span class="n">safe</span> <span class="n">thing</span> <span class="n">yum</span> <span class="n">can</span> <span class="k">do</span> <span class="n">is</span> <span class="n">fail</span><span class="p">.</span> <span class="n">There</span> <span class="n">are</span> <span class="n">a</span> <span class="n">few</span> <span class="n">ways</span> <span class="n">to</span> <span class="n">work</span> <span class="s">&quot;fix&quot;</span> <span class="n">this</span><span class="o">:</span>

     <span class="mf">1.</span> <span class="n">Contact</span> <span class="n">the</span> <span class="n">upstream</span> <span class="k">for</span> <span class="n">the</span> <span class="n">repository</span> <span class="n">and</span> <span class="n">get</span> <span class="n">them</span> <span class="n">to</span> <span class="n">fix</span> <span class="n">the</span> <span class="n">problem</span><span class="p">.</span>

     <span class="mf">2.</span> <span class="n">Reconfigure</span> <span class="n">the</span> <span class="n">baseurl</span><span class="o">/</span><span class="n">etc</span><span class="p">.</span> <span class="k">for</span> <span class="n">the</span> <span class="n">repository</span><span class="p">,</span> <span class="n">to</span> <span class="n">point</span> <span class="n">to</span> <span class="n">a</span> <span class="n">working</span>
        <span class="n">upstream</span><span class="p">.</span> <span class="n">This</span> <span class="n">is</span> <span class="n">most</span> <span class="n">often</span> <span class="n">useful</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">using</span> <span class="n">a</span> <span class="n">newer</span>
        <span class="n">distribution</span> <span class="n">release</span> <span class="n">than</span> <span class="n">is</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">the</span> <span class="n">repository</span> <span class="p">(</span><span class="n">and</span> <span class="n">the</span>
        <span class="n">packages</span> <span class="k">for</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">distribution</span> <span class="n">release</span> <span class="n">still</span> <span class="n">work</span><span class="p">).</span>

     <span class="mf">3.</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">command</span> <span class="n">with</span> <span class="n">the</span> <span class="n">repository</span> <span class="n">temporarily</span> <span class="n">disabled</span>
            <span class="n">yum</span> <span class="o">--</span><span class="n">disablerepo</span><span class="o">=</span><span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span> <span class="p">...</span>

     <span class="mf">4.</span> <span class="n">Disable</span> <span class="n">the</span> <span class="n">repository</span> <span class="n">permanently</span><span class="p">,</span> <span class="n">so</span> <span class="n">yum</span> <span class="n">won</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">use</span> <span class="n">it</span> <span class="n">by</span> <span class="k">default</span><span class="p">.</span> <span class="n">Yum</span>
        <span class="n">will</span> <span class="n">then</span> <span class="n">just</span> <span class="n">ignore</span> <span class="n">the</span> <span class="n">repository</span> <span class="n">until</span> <span class="n">you</span> <span class="n">permanently</span> <span class="n">enable</span> <span class="n">it</span>
        <span class="n">again</span> <span class="n">or</span> <span class="n">use</span> <span class="o">--</span><span class="n">enablerepo</span> <span class="k">for</span> <span class="n">temporary</span> <span class="n">usage</span><span class="o">:</span>

            <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">disable</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span>
        <span class="n">or</span>
            <span class="n">subscription</span><span class="o">-</span><span class="n">manager</span> <span class="n">repos</span> <span class="o">--</span><span class="n">disable</span><span class="o">=</span><span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span>

     <span class="mf">5.</span> <span class="n">Configure</span> <span class="n">the</span> <span class="n">failing</span> <span class="n">repository</span> <span class="n">to</span> <span class="n">be</span> <span class="n">skipped</span><span class="p">,</span> <span class="k">if</span> <span class="n">it</span> <span class="n">is</span> <span class="n">unavailable</span><span class="p">.</span>
        <span class="n">Note</span> <span class="n">that</span> <span class="n">yum</span> <span class="n">will</span> <span class="n">try</span> <span class="n">to</span> <span class="n">contact</span> <span class="n">the</span> <span class="n">repo</span><span class="p">.</span> <span class="n">when</span> <span class="n">it</span> <span class="n">runs</span> <span class="n">most</span> <span class="n">commands</span><span class="p">,</span>
        <span class="n">so</span> <span class="n">will</span> <span class="n">have</span> <span class="n">to</span> <span class="n">try</span> <span class="n">and</span> <span class="n">fail</span> <span class="n">each</span> <span class="n">time</span> <span class="p">(</span><span class="n">and</span> <span class="n">thus</span><span class="p">.</span> <span class="n">yum</span> <span class="n">will</span> <span class="n">be</span> <span class="n">be</span> <span class="n">much</span>
        <span class="n">slower</span><span class="p">).</span> <span class="n">If</span> <span class="n">it</span> <span class="n">is</span> <span class="n">a</span> <span class="n">very</span> <span class="n">temporary</span> <span class="n">problem</span> <span class="n">though</span><span class="p">,</span> <span class="n">this</span> <span class="n">is</span> <span class="n">often</span> <span class="n">a</span> <span class="n">nice</span>
        <span class="nl">compromise:</span>

            <span class="n">yum</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">save</span> <span class="o">--</span><span class="n">setopt</span><span class="o">=</span><span class="n">nvidia</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span><span class="p">.</span><span class="n">skip_if_unavailable</span><span class="o">=</span><span class="nb">true</span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># Test nvidia-smi with the latest official CUDA image</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">runtime</span><span class="o">=</span><span class="n">nvidia</span> <span class="o">--</span><span class="n">rm</span> <span class="n">nvidia</span><span class="o">/</span><span class="n">cuda</span><span class="o">:</span><span class="mf">9.0</span><span class="o">-</span><span class="n">base</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</pre></div>


<h1 id="_9">参考文献</h1>
<p><a href="https://blog.csdn.net/dongdong9223/article/details/52998375">如何进入、退出docker的container</a></p>
<p><a href="https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/docker.md">Using TensorFlow Serving via Docker</a></p>
<p><a href="https://segmentfault.com/a/1190000002567459">Docker学习之路（六）用commit命令创建镜像</a></p>
<p><a href="https://www.cnblogs.com/xhyan/p/6593075.html">Docker容器进入的4种方式</a></p>
<p><a href="https://www.cnblogs.com/YasinXiao/p/7736075.html">docker 启动，端口映射，挂载本地目录</a></p>
<p><a href="https://www.jb51.net/article/142459.htm">详解Docker 端口映射与容器互联</a></p>
<p><a href="https://www.jb51.net/article/127630.htm">Docker 给运行中的容器设置端口映射的方法</a></p>
<p><a href="https://www.cnblogs.com/kevingrace/p/9453987.html">Docker容器内部端口映射到外部宿主机端口的方法小结</a></p>
<p><a href="https://www.jb51.net/article/96617.htm">docker容器如何优雅的终止详解</a></p>
<p><a href="https://www.cnblogs.com/xiadongqing/p/6144053.html">docker-image container 基本操作 -常用命令</a></p>
<p><a href="https://www.cnblogs.com/jie-fang/p/7928406.html">Docker实战-为镜像添加SSH服务</a></p>
<p><a href="https://blog.csdn.net/hpf247/article/details/80078240">Linux系统安装docker并用ssh登录docker容器</a></p>
<p><a href="https://blog.csdn.net/qq_39626154/article/details/82856865">Docker 容器开启ssh登录</a></p>
<p><a href="https://github.com/NVIDIA/nvidia-docker">NVIDIA Container Runtime for Docker</a></p>
</div>
<div id="content-footer">created in <span class="create-date date"> 2018-07-25 10:00 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  title: 'docker使用教程',
  owner: 'sthsf',
  repo: 'wiki',
  oauth: {
    client_id: '086c54c5fd95adfdc372',
    client_secret: '2ad9ebe87b952d2c77fccf99c334881b91eaa73d',
  },
  // ...
  // For more available options, check out the documentation below
})
gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

</div>
<div id="footer">
            <span>
                Copyright © 2019 LiYu.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/sthsf/wiki" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?90e1dcdd1938573c19f9ff6521188e91";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>