<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>JupyterHub 部署与应用指南 - LiYu's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Economics"/>
    <meta name="description" content="A wiki website of sthsf when I learned new knowledgy and technics."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Linux Tricks">Linux Tricks</a>&nbsp;»&nbsp;JupyterHub 部署与应用指南</div>
</div>
<div class="clearfix"></div>
<div id="title">JupyterHub 部署与应用指南</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1jupyterhub-on-kubernetes">1、JupyterHub on Kubernetes部署与应用指南</a></li>
<li><a href="#jupyterhub">jupyterHub 安装</a><ul>
<li><a href="#1virtualenv">1、virtualenv 下安装与配置</a><ul>
<li><a href="#jupyterhub_1">安装jupyterhub</a></li>
<li><a href="#jupyterhub_2">配置jupyterhub</a></li>
<li><a href="#_1">创建多用户</a></li>
<li><a href="#jupyterhub_3">jupyterhub的启动配置</a></li>
<li><a href="#nohup">使用nohup让程序在后台运行.</a></li>
<li><a href="#_2">开机运行</a></li>
</ul>
</li>
<li><a href="#2docker-jupyterhub">2、Docker 下运行jupyterhub</a></li>
</ul>
</li>
<li><a href="#_3"></a></li>
<li><a href="#_4">参考文献</a></li>
</ul>
</div>
<h1 id="1jupyterhub-on-kubernetes">1、JupyterHub on Kubernetes部署与应用指南</h1>
<h1 id="jupyterhub">jupyterHub 安装</h1>
<h2 id="1virtualenv">1、virtualenv 下安装与配置</h2>
<h3 id="jupyterhub_1">安装jupyterhub</h3>
<p>在装好的虚拟环境下安装jupyterhub,首先要保证使用的python版本是3.0以上的版本,官方说明只支持3.0以上的版本.</p>
<div class="hlcode"><pre><span class="n">pip</span> <span class="n">install</span> <span class="n">jupyterhub</span>
</pre></div>


<p>在使用pip安装的时候需要安装nodejs/npm，</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">npm</span> <span class="n">nodejs</span><span class="o">-</span><span class="n">legacy</span>
</pre></div>


<p>如果想要在本地运行notebook服务,还需要在本地安装jupyter notebook包</p>
<div class="hlcode"><pre><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">notebook</span>
</pre></div>


<h3 id="jupyterhub_2">配置jupyterhub</h3>
<div class="hlcode"><pre><span class="n">jupyterhub</span> <span class="o">--</span><span class="n">generate</span><span class="o">-</span><span class="n">config</span>
</pre></div>


<p>这时候当前目录相面会生成<code>jupyterhub_config.py</code>的配置文件.<br />
注, 如果想要在某个文件目录下生成,则需要在那个文件目录下运行上面的文件.</p>
<p>生成配置文件之后,可以进行适当的配置, 如</p>
<div class="hlcode"><pre><span class="cp"># 端口和ip</span>
<span class="n">c</span><span class="p">.</span><span class="n">JupyterHub</span><span class="p">.</span><span class="n">ip</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">IP</span><span class="err">地址&#39;</span>
<span class="n">c</span><span class="p">.</span><span class="n">JupyterHub</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="err">端口</span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># 参考github上jupyterhub的说明, 在/opt/nodejs 目录中安装</span>
<span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span>
<span class="err">注</span><span class="p">,</span> <span class="err">当然</span><span class="p">,</span><span class="err">不一定在</span><span class="n">opt</span><span class="err">目录下面</span><span class="p">,</span> <span class="err">可以通过</span><span class="n">whereis</span> <span class="n">nodejs</span><span class="p">,</span><span class="err">查看你所安装的</span><span class="n">nodejs</span><span class="err">所在的位置</span><span class="p">,</span><span class="err">我的文件就保存在&#39;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nodejs</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="n">v10</span><span class="mf">.15.0</span><span class="o">/</span><span class="n">bin</span><span class="err">&#39;下</span>

<span class="n">c</span><span class="p">.</span><span class="n">JupyterHub</span><span class="p">.</span><span class="n">proxy_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="err">&#39;</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nodejs</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span><span class="err">&#39;</span><span class="p">,]</span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># 设置默认登陆jupyterhub后的目录,这是相对目录,用户登陆后会在当前用户的/notebook文件夹下,如果用户没有/notebook这个文件夹,启动过程可能会失败</span>
<span class="n">c</span><span class="p">.</span><span class="n">Spawner</span><span class="p">.</span><span class="n">notebook_dir</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">~/</span><span class="n">notebook</span><span class="err">&#39;</span>

<span class="cp"># 该方式设置了绝对路径,所有用户登陆jupyterhub的时候,都会在&#39;/home/ubuntu/notebook/&#39;这个目录下</span>
<span class="n">c</span><span class="p">.</span><span class="n">Spawner</span><span class="p">.</span><span class="n">notebook_dir</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">notebook</span><span class="err">&#39;</span>
</pre></div>


<h3 id="_1">创建多用户</h3>
<p>首先除了当前root用户之外,我们还可以新建其他的用户作为普通用户,这个还是跟linux下添加用户一样</p>
<div class="hlcode"><pre><span class="n">adduser</span> <span class="n">user1</span>
</pre></div>


<p>根据系统提示,设置密码和身份等东西.</p>
<p>设置完成之后在配置文件中添加相应的设置</p>
<div class="hlcode"><pre><span class="mi">1</span><span class="err">、添加普通用户</span>
<span class="n">c</span><span class="p">.</span><span class="n">Authenticator</span><span class="p">.</span><span class="n">whitelist</span> <span class="o">=</span> <span class="p">{</span><span class="err">&#39;</span><span class="n">user1</span><span class="err">&#39;</span><span class="p">}</span>

<span class="mi">2</span><span class="err">、添加管理员</span>
<span class="n">c</span><span class="p">.</span><span class="n">Authenticator</span><span class="p">.</span><span class="n">admin_users</span> <span class="o">=</span> <span class="p">{</span><span class="err">&#39;</span><span class="n">ubuntu</span><span class="err">&#39;</span><span class="p">}</span>
</pre></div>


<h3 id="jupyterhub_3">jupyterhub的启动配置</h3>
<h3 id="nohup">使用nohup让程序在后台运行.</h3>
<p>注, 运行时好像需要在root用户下运行,其他用户运行可能会导致有的用户启动不了.如果想要使用sudo运行而不用root用户运行,可以参考<a href="https://github.com/jupyterhub/jupyterhub/wiki/Using-sudo-to-run-JupyterHub-without-root-privileges">Using sudo to run JupyterHub without root privileges</a></p>
<div class="hlcode"><pre><span class="n">nohup</span> <span class="n">jupyterhub</span> <span class="o">&gt;</span> <span class="n">jupyterhub</span><span class="p">.</span><span class="n">log</span> <span class="o">&amp;</span>
</pre></div>


<h3 id="_2">开机运行</h3>
<p>开机配置</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">cat</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">jupyterhub</span><span class="p">.</span><span class="n">service</span>  
<span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">Jupyterhub</span>
<span class="n">After</span><span class="o">=</span><span class="n">syslog</span><span class="p">.</span><span class="n">target</span> <span class="n">network</span><span class="p">.</span><span class="n">target</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">root</span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">xyq</span><span class="o">/</span><span class="p">.</span><span class="n">jupyter</span><span class="o">/</span><span class="n">run_hub</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="p">.</span><span class="n">target</span>
</pre></div>


<p>启动</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">jupyterhub</span> <span class="err">#</span> <span class="err">开机自启动</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>     <span class="err">#</span> <span class="err">加载配置文件</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">jupyterhub</span>  <span class="err">#</span> <span class="err">启动</span>
<span class="n">sudo</span> <span class="n">journalctl</span> <span class="o">-</span><span class="n">u</span> <span class="n">jupyterhub</span>    <span class="err">#</span> <span class="err">查看</span><span class="n">log</span>
</pre></div>


<h2 id="2docker-jupyterhub">2、Docker 下运行jupyterhub</h2>
<ul>
<li>1、pull 一个纯净的ubuntu环境</li>
<li>2、进入ubuntu docker, 安装相关软件, 这里仅考虑安装的最基本的应用需求, 其他需要自行下载.</li>
</ul>
<div class="hlcode"><pre><span class="n">python3</span>
<span class="n">vim</span>
</pre></div>


<p>docker下的应用的安装和使用可以参见<a href="https://sthsf.github.io/wiki/Linux%20Tricks/docker%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html">Docker使用教程</a>和<a href="https://sthsf.github.io/wiki/Linux%20Tricks/python3.5%E5%8D%87%E7%BA%A7%E5%88%B0python3.6.html">python3.5升级到python3.6</a>中的相关内容.</p>
<ul>
<li>3、安装基于python3的虚拟环境<br />
虚拟环境的使用参考<a href="https://sthsf.github.io/wiki/Linux%20Tricks/virtualenv%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html">virtualenv使用教程</a></li>
</ul>
<p>当然你也可以使用annaconda进行安装, 据说annaconda安装不会出现下面的问题.<br />
- 4、配置好之后进入虚拟环境, 使用pip安装和生成jupyterhub配置文件, 同第一节中的安装方式.</p>
<p>在执行过程中会出现下面的错误, 正确的使用方式如下:</p>
<p><strong>不使用npm安装configurable-http-proxy</strong></p>
<p>直接从源码安装nodejs,安装方法见<a href="https://github.com/nodejs/help/wiki/Installation">官网Installation</a>,我这里为了方便,直接将源码放在虚拟环境的conf文件夹下.</p>
<p>然后在<code>~/.bashrc</code>中添加环境变量</p>
<div class="hlcode"><pre><span class="n">export</span> <span class="n">NODEJS_HOME</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nodejs</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="n">v10</span><span class="mf">.15.0</span><span class="o">/</span><span class="n">bin</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">$</span><span class="n">NODEJS_HOME</span><span class="o">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">NODEJS_HOME</span>
</pre></div>


<p>其中,<code>node-v10.15.0</code>就是自己下载的源码压缩包解压缩的内容.</p>
<p>使用源码安装配置的nodejs版本为<code>v10.15.0</code>, 官网说源码自带npm, 里面的npm版本为<code>6.6.0</code></p>
<p>所有才有前文,我的nodejs的文件目录跟默认的安装路径的区别</p>
<ul>
<li>5、在配置文件目录下运行jupyterhub,其他配置没有改变,结束.</li>
</ul>
<p><strong>错误过程</strong><br />
有人在使用sudo apt-get install npm nodejs-legacy的时候,安装完成后就算在jupyterhub_configure.py下配置了configurable-http-proxy的路径,或者使用<code>configurable-http-proxy -h</code>的时候会出现下面的问题,主要是nodejs安装版本可能比较低</p>
<p>使用<code>sudo apt-get install npm</code>安装完成之后,查看npm的版本<code>npm -v</code>, 版本号为<code>3.5.2</code></p>
<p>使用<code>sudo apt-get install nodejs-legacy</code>安装完成之后,查看node的版本<code>node -v</code>, 版本号为<code>v4.2.6</code></p>
<p>使用<code>npm install -g configurable-http-proxy</code> 安装会出现下面的提示</p>
<div class="hlcode"><pre><span class="o">-</span> <span class="o">|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|</span>
<span class="n">loadRequestedDeps</span>         <span class="err">\</span> <span class="o">|</span><span class="err">###############################</span><span class="o">-----------------------------------------------------------------------------------------------------------------------|</span>
<span class="nl">loadDep:</span><span class="n">winston</span> <span class="o">-&gt;</span> <span class="n">header</span> <span class="o">|</span> <span class="o">|</span><span class="err">###############################</span><span class="o">-----------------------------------------------------------------------------------------------------------------------|</span>
<span class="nl">loadDep:</span><span class="n">winston</span><span class="o">-</span><span class="n">transport</span> <span class="o">-</span> <span class="o">|</span><span class="err">####################################################</span><span class="o">--------------------------------------------------------------------------------------------------|</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span>
<span class="err">`</span><span class="o">--</span> <span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span><span class="err">@</span><span class="mf">4.0.1</span>
  <span class="o">+--</span> <span class="n">commander</span><span class="err">@</span><span class="mf">2.19.0</span>
  <span class="o">+--</span> <span class="n">http</span><span class="o">-</span><span class="n">proxy</span><span class="err">@</span><span class="mf">1.17.0</span>
  <span class="o">|</span> <span class="o">+--</span> <span class="n">eventemitter3</span><span class="err">@</span><span class="mf">3.1.0</span>
  <span class="o">|</span> <span class="o">+--</span> <span class="n">follow</span><span class="o">-</span><span class="n">redirects</span><span class="err">@</span><span class="mf">1.7.0</span>
  <span class="o">|</span> <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">debug</span><span class="err">@</span><span class="mf">3.2.6</span>
  <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">requires</span><span class="o">-</span><span class="n">port</span><span class="err">@</span><span class="mf">1.0.0</span>
  <span class="o">+--</span> <span class="n">lynx</span><span class="err">@</span><span class="mf">0.2.0</span>
  <span class="o">|</span> <span class="o">+--</span> <span class="n">mersenne</span><span class="err">@</span><span class="mf">0.0.4</span>
  <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">statsd</span><span class="o">-</span><span class="n">parser</span><span class="err">@</span><span class="mf">0.0.4</span>
  <span class="o">+--</span> <span class="n">strftime</span><span class="err">@</span><span class="mf">0.10.0</span>
  <span class="err">`</span><span class="o">--</span> <span class="n">winston</span><span class="err">@</span><span class="mf">3.1.0</span>
    <span class="o">+--</span> <span class="n">async</span><span class="err">@</span><span class="mf">2.6.2</span>
    <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">lodash</span><span class="err">@</span><span class="mf">4.17.11</span>
    <span class="o">+--</span> <span class="n">diagnostics</span><span class="err">@</span><span class="mf">1.1.1</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">colorspace</span><span class="err">@</span><span class="mf">1.1.1</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">+--</span> <span class="n">color</span><span class="err">@</span><span class="mf">3.0.0</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">+--</span> <span class="n">color</span><span class="o">-</span><span class="n">convert</span><span class="err">@</span><span class="mf">1.9.3</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">color</span><span class="o">-</span><span class="n">name</span><span class="err">@</span><span class="mf">1.1.3</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">color</span><span class="o">-</span><span class="n">string</span><span class="err">@</span><span class="mf">1.5.3</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>   <span class="err">`</span><span class="o">--</span> <span class="n">simple</span><span class="o">-</span><span class="n">swizzle</span><span class="err">@</span><span class="mf">0.2.2</span>
    <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>     <span class="err">`</span><span class="o">--</span> <span class="n">is</span><span class="o">-</span><span class="n">arrayish</span><span class="err">@</span><span class="mf">0.3.2</span>
    <span class="o">|</span> <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">text</span><span class="o">-</span><span class="n">hex</span><span class="err">@</span><span class="mf">1.0.0</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">enabled</span><span class="err">@</span><span class="mf">1.0.2</span>
    <span class="o">|</span> <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">env</span><span class="o">-</span><span class="n">variable</span><span class="err">@</span><span class="mf">0.0.5</span>
    <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">kuler</span><span class="err">@</span><span class="mf">1.0.1</span>
    <span class="o">|</span>   <span class="err">`</span><span class="o">--</span> <span class="n">colornames</span><span class="err">@</span><span class="mf">1.1.1</span>
    <span class="o">+--</span> <span class="n">is</span><span class="o">-</span><span class="n">stream</span><span class="err">@</span><span class="mf">1.1.0</span>
    <span class="o">+--</span> <span class="n">logform</span><span class="err">@</span><span class="mf">1.10.0</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">colors</span><span class="err">@</span><span class="mf">1.3.3</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">fast</span><span class="o">-</span><span class="n">safe</span><span class="o">-</span><span class="n">stringify</span><span class="err">@</span><span class="mf">2.0.6</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">fecha</span><span class="err">@</span><span class="mf">2.3.3</span>
    <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">ms</span><span class="err">@</span><span class="mf">2.1.1</span>
    <span class="o">+--</span> <span class="n">one</span><span class="o">-</span><span class="n">time</span><span class="err">@</span><span class="mf">0.0.4</span>
    <span class="o">+--</span> <span class="n">readable</span><span class="o">-</span><span class="n">stream</span><span class="err">@</span><span class="mf">2.3.6</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">core</span><span class="o">-</span><span class="n">util</span><span class="o">-</span><span class="n">is</span><span class="err">@</span><span class="mf">1.0.2</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">inherits</span><span class="err">@</span><span class="mf">2.0.3</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">isarray</span><span class="err">@</span><span class="mf">1.0.0</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">process</span><span class="o">-</span><span class="n">nextick</span><span class="o">-</span><span class="n">args</span><span class="err">@</span><span class="mf">2.0.0</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">safe</span><span class="o">-</span><span class="n">buffer</span><span class="err">@</span><span class="mf">5.1.2</span>
    <span class="o">|</span> <span class="o">+--</span> <span class="n">string_decoder</span><span class="err">@</span><span class="mf">1.1.1</span>
    <span class="o">|</span> <span class="err">`</span><span class="o">--</span> <span class="n">util</span><span class="o">-</span><span class="n">deprecate</span><span class="err">@</span><span class="mf">1.0.2</span>
    <span class="o">+--</span> <span class="n">stack</span><span class="o">-</span><span class="n">trace</span><span class="err">@</span><span class="mf">0.0.10</span>
    <span class="o">+--</span> <span class="n">triple</span><span class="o">-</span><span class="n">beam</span><span class="err">@</span><span class="mf">1.3.0</span>
    <span class="err">`</span><span class="o">--</span> <span class="n">winston</span><span class="o">-</span><span class="n">transport</span><span class="err">@</span><span class="mf">4.3.0</span>
</pre></div>


<p>configurable-http-proxy的整个安装过程没有错误提示, 但是使用<code>configurable-http-proxy -h</code>检查的时候出现下面的错误:</p>
<div class="hlcode"><pre><span class="p">/</span><span class="nx">usr</span><span class="p">/</span><span class="nb">local</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">node_modules</span><span class="p">/</span><span class="nx">configurable</span><span class="na">-http-proxy</span><span class="p">/</span><span class="nx">node_modules</span><span class="p">/</span><span class="nx">winston</span><span class="p">/</span><span class="nx">lib</span><span class="p">/</span><span class="nx">winston.js</span><span class="p">:</span><span class="mi">11</span>
<span class="nx">const</span> <span class="p">{</span> <span class="nx">warn</span> <span class="p">}</span> <span class="o">=</span> <span class="k">require</span><span class="err">(&#39;.</span><span class="n">/</span><span class="nx">winston</span><span class="p">/</span><span class="nx">common</span><span class="s1">&#39;);</span>
<span class="s1">      ^</span>

<span class="s1">SyntaxError: Unexpected token {</span>
<span class="s1">    at exports.runInThisContext (vm.js:53:16)</span>
<span class="s1">    at Module._compile (module.js:374:25)</span>
<span class="s1">    at Object.Module._extensions..js (module.js:417:10)</span>
<span class="s1">    at Module.load (module.js:344:32)</span>
<span class="s1">    at Function.Module._load (module.js:301:12)</span>
<span class="s1">    at Module.require (module.js:354:17)</span>
<span class="s1">    at require (internal/module.js:12:17)</span>
<span class="s1">    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/configurable-http-proxy/bin/configurable-http-proxy:14:13)</span>
<span class="s1">    at Module._compile (module.js:410:26)</span>
<span class="s1">    at Object.Module._extensions..js (module.js:417:10)</span>
</pre></div>


<p>上面的安装步骤都是正确的,而且没有报错,官网github的<strong><a href="https://github.com/jupyterhub/jupyterhub/issues/2332">issue</a></strong>中有关于上面类似的问题,里面有人提到可能是npm的版本过低或者不对应等问题,于是到node的官网查看node的发行版本,发现node的版本都已经V10以上了,而本地npm安装的版本才4.推测可能是版本太低,不兼容所致.</p>
<p>于是尝试升级npm,node,结果使用<code>npm install npm -g</code>依然无法升级到最新的版本.最终的解决方法是直接从官网把源码下下来,然后配置一下环境变量,具体参见前面的操作步骤</p>
<p>后面,上面的的问题通过更新的方法没有解决有点不甘心,然后又使用<code>whereis nodejs</code>将安装路径找出来.</p>
<div class="hlcode"><pre><span class="nl">nodejs:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">nodejs</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nodejs</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">nodejs</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nodejs</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">man</span><span class="o">/</span><span class="n">man1</span><span class="o">/</span><span class="n">nodejs</span><span class="mf">.1</span><span class="p">.</span><span class="n">gz</span>
</pre></div>


<p>然后找到<code>configurable-http-proxy</code>的安装目录<code>/usr/local/lib/node_modules/configurable-http-proxy</code>,将它添加到jupyterhub_config.py中,然后运行jupyterhub.</p>
<p>之前的错误提示没了,但是后面又出现了下面的问题:</p>
<div class="hlcode"><pre><span class="p">[</span><span class="n">I</span> <span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">07</span> <span class="mi">14</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mf">04.979</span> <span class="n">JupyterHub</span> <span class="n">proxy</span><span class="o">:</span><span class="mi">567</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">proxy</span> <span class="err">@</span> <span class="n">http</span><span class="o">:</span><span class="c1">//:8000</span>
<span class="p">[</span><span class="n">C</span> <span class="mi">2019</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">07</span> <span class="mi">14</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="mf">04.980</span> <span class="n">JupyterHub</span> <span class="n">app</span><span class="o">:</span><span class="mi">1867</span><span class="p">]</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">proxy</span>
    <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span><span class="o">:</span>
      <span class="n">File</span> <span class="s">&quot;/usr/local/lib/python3.6/dist-packages/jupyterhub/app.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1865</span><span class="p">,</span> <span class="n">in</span> <span class="n">start</span>
        <span class="n">await</span> <span class="n">self</span><span class="p">.</span><span class="n">proxy</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
      <span class="n">File</span> <span class="s">&quot;/usr/local/lib/python3.6/dist-packages/jupyterhub/proxy.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">571</span><span class="p">,</span> <span class="n">in</span> <span class="n">start</span>
        <span class="n">self</span><span class="p">.</span><span class="n">proxy_process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">start_new_session</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">)</span>
      <span class="n">File</span> <span class="s">&quot;/usr/lib/python3.6/subprocess.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">709</span><span class="p">,</span> <span class="n">in</span> <span class="n">__init__</span>
        <span class="n">restore_signals</span><span class="p">,</span> <span class="n">start_new_session</span><span class="p">)</span>
      <span class="n">File</span> <span class="s">&quot;/usr/lib/python3.6/subprocess.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1344</span><span class="p">,</span> <span class="n">in</span> <span class="n">_execute_child</span>
        <span class="n">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">errno_num</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">,</span> <span class="n">err_filename</span><span class="p">)</span>
    <span class="nl">PermissionError:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">13</span><span class="p">]</span> <span class="n">Permission</span> <span class="n">denied</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">configurable</span><span class="o">-</span><span class="n">http</span><span class="o">-</span><span class="n">proxy</span><span class="err">&#39;</span>
</pre></div>


<p>权限问题,一脸懵,所有的操作都是root用户,又去查看了node_modules这个文件,发现用户名是nobody,又是一脸懵.算了,使用777修改文件夹的权限.修改完之后重新运行jupyterhu还是同样的问题,这个问题就没有解决了,最后还是使用上面的的教程,从官网下载nodejs替换之后两个问题都没有出现,jupyterhub可以在docker上启动,其他配置需要自己配置.</p>
<p><strong>ps</strong>,之前学习使用nodejs的时候刚开始也是使用npm来做程序管理的, 但是是由于npm一直无法更新到最新, 后来才从源码安装的.</p>
<p><strong>ps</strong>网上说npm的镜像在国外, 也有可能自己在使用npm升级的时候没有升级成功, 导致一系列的错误, 但是升级不成功他也不能没有提示吧. 有空可以设置使用淘宝镜像然后再尝试尝试.</p>
<h1 id="_3"></h1>
<h1 id="_4">参考文献</h1>
<p><a href="https://www.jianshu.com/p/fd9ddce53465">搭建一套云工作平台 (JupyterHub + Rstudio Server)</a></p>
<p><a href="https://my.oschina.net/u/2306127/blog/1837196">JupyterHub on Kubernetes部署与应用指南</a></p>
<p><a href="https://www.liangzl.com/get-article-detail-16066.html">为JupyterHub自定义Notebook Images</a></p>
<p><a href="https://blog.csdn.net/vah101/article/details/79793006">JupyterHub + toree安装说明</a></p>
<p><a href="https://blog.csdn.net/Fire_to_cheat_/article/details/84938975">jupyter notebook安装插件，代码补全</a></p>
<p><a href="https://jupyterhub.readthedocs.io/en/latest/index.html">JupyterHub</a></p>
<p><a href="https://hub.docker.com/r/jupyterhub/jupyterhub/">Docker JupyterHub</a></p>
<p><a href="https://www.cnblogs.com/bregman/p/5744109.html">jupyterhub 安装配置</a></p>
<p><a href="https://zero-to-jupyterhub.readthedocs.io/en/latest/">Zero to JupyterHub with Kubernetes</a></p>
<p><a href="https://www.jianshu.com/p/0285feaa2ba2">在AWS上配置jupyterhub</a></p>
</div>
<div id="content-footer">created in <span class="create-date date"> 2019-03-02 00:00 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  title: 'JupyterHub 部署与应用指南',
  owner: 'sthsf',
  repo: 'wiki',
  oauth: {
    client_id: '086c54c5fd95adfdc372',
    client_secret: '2ad9ebe87b952d2c77fccf99c334881b91eaa73d',
  },
  // ...
  // For more available options, check out the documentation below
})
gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

</div>
<div id="footer">
            <span>
                Copyright © 2019 LiYu.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/sthsf/wiki" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?90e1dcdd1938573c19f9ff6521188e91";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>